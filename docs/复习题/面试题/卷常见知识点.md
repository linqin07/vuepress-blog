### 1.mysql中myisam与innodb的区别

|          类型          |                            myisam                            |                            innodb                            |
| :--------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|       `事务支持`       |             不支持：查询更快，每次查询具有原子性             |                        支持事务，回滚                        |
|         锁粒度         |                            表级锁                            |                           `行级锁`                           |
|          外键          |                         MyISAM不支持                         |                       InnoDB支持`外键`                       |
|         表主键         |     允许没有任何索引和主键的表存在，索引都是保存行的地址     | 如果没有设定主键或者非空唯一索引，就会自动生成一个6字节的主键(用户不可见) |
|       `全文索引`       |                          MyISAM支持                          |                     InnoDB不支持全文索引                     |
| 可移植性、备份及`恢复` | 数据是以文件的形式存储，所以在跨平台的数据转移中会很方便。在备份和恢复时可单独针对某个表进行操作 | 免费的方案可以是拷贝数据文件、备份 binlog或者用mysqldump，在数据量达到几十G的时候就相对痛苦了 |

myisam适合`查询多`的，innodob适合新增删除操作

### 2.sql执行流程

![image-20220220000520424](https://gitee.com/linqin07/pic/raw/master/image-20220220000520424.png)

sql执行首先看是否开启了缓存（5.8移除了缓存），sql进来先分析，包括语法分析和语义检查，生成语法树，再经过优化器，优化器分为物理优化和逻辑优化。物理优化就是使用索引，逻辑优化就是优化sql，比如一些联表查询的优化，优化完生成执行计划（查询树），最后执行得到查询结果了。



### 3.b+树为什么高度不超过4层

为什么二叉排序树不行：时间复杂度为 log2n的对数，而b+树的复杂度为明显低，以为树高度一般为3就足够了。

每一层就需要一次io操作加载到内存。为啥使用b+树就是为了减少和磁盘io交互。





### 4.聚簇索引

![image-20220220152821581](https://gitee.com/linqin07/pic/raw/master/image-20220220152821581.png)

聚簇索引就是按照每张表的主键构造一颗B+树，同时叶子节点中存放的就是整张表的行记录数据，也将聚集索引的叶子节点称为数据页。这个特性决定了索引组织表中数据也是索引的一部分，每张表只能拥有一个聚簇索引。

特点：

- 数据页内的记录是根据主键大小顺序排序单向链表
- 数据页是也是根据主键大小顺序排列为双向链表
- 记录页也是根据主键大小顺序排列的双向链表
- 数据页存储所有列的值

缺点：

- 插入速度严重依赖主键顺序
- 二级索引访问需要回表操作
- 更新主键的代价很高



### 5.二级索引（辅助索引、非聚簇索引）

**聚簇索引之上创建的索引称之为辅助索引**，辅助索引访问数据总是需要二次查找。Innodb辅助索引的叶子节点并`不包含`行记录的全部数据。

二级索引记录页中的数据有：索引列的值、`主键值`、数据页的页号

![image-20220221004110400](https://gitee.com/linqin07/pic/raw/master/image-20220221004110400.png)



概念：**回表** 

我们根据这个以c2列大小排序的B+树只能确定我们要查找记录的主键值，所以如果我们想根
据c2列的值查找到完整的用户记录的话，仍然需要到 聚簇索引 中再查一遍，这个过程称为 回表 。也就
是根据c2列的值查询一条完整的用户记录需要使用到 2 棵B+树。





### 6.联合索引

我们也可以同时以多个列的大小作为排序规则，也就是同时为多个列建立索引，比方说我们想让B+树按
照 c2和c3列的大小进行排序，这个包含两层含义：

先把各个记录和页按照c2列进行排序。
在记录的c2列相同的情况下，采用c3列进行排序



### 7.MyISAM 与 InnoDB对比

![MyISAM 的索引结构](https://gitee.com/linqin07/pic/raw/master/image-20220221004526617.png)

MyISAM的索引方式都是“非聚簇”的，与InnoDB包含1个聚簇索引是不同的。小结两种引擎中索引的区
别：
① 在InnoDB存储引擎中，我们只需要根据主键值对 聚簇索引 进行一次查找就能找到对应的记录，而在
MyISAM 中却需要进行一次 `回表` 操作，意味着MyISAM中建立的索引相当于全部都是 `二级索引` 。
② InnoDB的`数据文件本身就是索引`文件，而MyISAM索引文件和数据文件是 分离的 ，索引文件仅保存数
据记录的地址。
③ InnoDB的非聚簇索引data域存储相应记录 `主键`的值 ，而MyISAM索引记录的是 `地址` 。换句话说，
InnoDB的所有非聚簇索引都引用主键作为data域。
④ MyISAM的回表操作是十分 快速 的，因为是拿着地址偏移量直接到文件中取数据的，反观InnoDB是通
过获取主键之后再去聚簇索引里找记录，虽然说也不慢，但还是比不上直接用地址去访问。
⑤ InnoDB要求表 必须有主键 （ MyISAM可以没有 ）。如果没有显式指定，则MySQL系统会自动选择一个
可以非空且唯一标识数据记录的列作为主键。如果不存在这种列，则MySQL自动为InnoDB表生成一个`隐`
`含字段`作为主键，这个字段长度为6个字节，类型为长整型



8.自适应 Hash

```mysql
mysql> show variables like '%adaptive_hash_index';
```

![adaptive_hash_index](https://gitee.com/linqin07/pic/raw/master/image-20220221010208427.png)





