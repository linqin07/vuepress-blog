### 1.mysql中myisam与innodb的区别

|          类型          |                            myisam                            |                            innodb                            |
| :--------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|       `事务支持`       |             不支持：查询更快，每次查询具有原子性             |                        支持事务，回滚                        |
|         锁粒度         |                            表级锁                            |                           `行级锁`                           |
|          外键          |                         MyISAM不支持                         |                       InnoDB支持`外键`                       |
|         表主键         |     允许没有任何索引和主键的表存在，索引都是保存行的地址     | 如果没有设定主键或者非空唯一索引，就会自动生成一个6字节的主键(用户不可见) |
|       `全文索引`       |                          MyISAM支持                          |                     InnoDB不支持全文索引                     |
| 可移植性、备份及`恢复` | 数据是以文件的形式存储，所以在跨平台的数据转移中会很方便。在备份和恢复时可单独针对某个表进行操作 | 免费的方案可以是拷贝数据文件、备份 binlog或者用mysqldump，在数据量达到几十G的时候就相对痛苦了 |

myisam适合`查询多`的，innodob适合新增删除操作

### 2.sql执行流程

![image-20220220000520424](https://gitee.com/linqin07/pic/raw/master/image-20220220000520424.png)

sql执行首先看是否开启了缓存（5.8移除了缓存），sql进来先分析，包括语法分析和语义检查，生成语法树，再经过优化器，优化器分为物理优化和逻辑优化。物理优化就是使用索引，逻辑优化就是优化sql，比如一些联表查询的优化，优化完生成执行计划（查询树），最后执行得到查询结果了。



### 3.b+树为什么高度不超过4层

每一层就需要一次io操作加载到内存。假设每页16kb





### 4.聚簇索引

![image-20220220152821581](https://gitee.com/linqin07/pic/raw/master/image-20220220152821581.png)

聚簇索引就是按照每张表的主键构造一颗B+树，同时叶子节点中存放的就是整张表的行记录数据，也将聚集索引的叶子节点称为数据页。这个特性决定了索引组织表中数据也是索引的一部分，每张表只能拥有一个聚簇索引。

特点：

- 数据页内的记录是根据主键大小顺序排序单向链表
- 数据页是也是根据主键大小顺序排列为双向链表
- 记录页也是根据主键大小顺序排列的双向链表
- 存储所有列的值

缺点：

- 插入速度严重依赖主键顺序
- 二级索引访问需要回表操作
- 更新主键的代价很高



### 5.二级索引（辅助索引、非聚簇索引）

**聚簇索引之上创建的索引称之为辅助索引**，辅助索引访问数据总是需要二次查找。Innodb辅助索引的叶子节点并`不包含`行记录的全部数据

概念：**回表** 

我们根据这个以c2列大小排序的B+树只能确定我们要查找记录的主键值，所以如果我们想根
据c2列的值查找到完整的用户记录的话，仍然需要到 聚簇索引 中再查一遍，这个过程称为 回表 。也就
是根据c2列的值查询一条完整的用户记录需要使用到 2 棵B+树



### 6.联合索引

我们也可以同时以多个列的大小作为排序规则，也就是同时为多个列建立索引，比方说我们想让B+树按
照 c2和c3列的大小进行排序，这个包含两层含义：

先把各个记录和页按照c2列进行排序。
在记录的c2列相同的情况下，采用c3列进行排序



