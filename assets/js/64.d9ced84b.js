(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{289:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"_1-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.安装")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.elastic.co/cn/products",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("找到对应版本的es进行下载上传服务器。或者找到下载链接使用linux远程"),a("code",[s._v("wget")]),s._v("下载。")]),s._v(" "),a("p",[s._v("jdk需要先安装好。")]),s._v(" "),a("h3",{attrs:{id:"_2-修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.修改配置")]),s._v(" "),a("h6",{attrs:{id:"默认配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 默认配置")]),s._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" datacenter\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("transport.tcp.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v("\n")])])]),a("p",[s._v("其中还可以配置允许自动创建索引")]),s._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("action.auto_create_index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('".security*,.monitoring*,.watches,.triggered_watches,.watcher-history*,.ml*"')]),s._v("\n")])])]),a("h6",{attrs:{id:"集群配置增加"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群配置增加","aria-hidden":"true"}},[s._v("#")]),s._v(" 集群配置增加")]),s._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery.zen.ping.unicast.hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.152.128"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.152.129"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Prevent the "split brain" by configuring the majority of nodes (total number of master-eligible nodes / 2 + 1):')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery.zen.minimum_master_nodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),a("p",[s._v("发现无法加入节点，可以尝试删除data目录的所有文件试试。复制的节点不能有原来的垃圾数据。")]),s._v(" "),a("h3",{attrs:{id:"_3-启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.启动")]),s._v(" "),a("p",[s._v("不能使用root用户启动。当然也不能安装到"),a("code",[s._v("/root")]),s._v("目录，一切换用户就没有权限访问了。")]),s._v(" "),a("p",[s._v("如果没用用户先创建用户。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" es\n")])])]),a("p",[s._v("安装目录赋权")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R es:es /data/elasticsearch-6.3.0\n")])])]),a("p",[s._v("切换用户"),a("code",[s._v("bin")]),s._v("目录下"),a("strong",[s._v("启动")])]),s._v(" "),a("p",[a("code",[s._v("-d")]),s._v("参数表示后台运行")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./elasticsearch\n")])])]),a("h6",{attrs:{id:"坑点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#坑点","aria-hidden":"true"}},[s._v("#")]),s._v(" 坑点")]),s._v(" "),a("ol",[a("li",[s._v("ERROR: [2] bootstrap checks failed\n[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]\n[2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]")])]),s._v(" "),a("p",[s._v("第一个：调节并发连接数。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/security/limits.conf\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("# End of file\n* soft nofile 655360\n* hard nofile 655360\nroot soft nofile 100001\nroot hard nofile 100002\n")])])]),a("p",[s._v("第二个：错误表示修改虚拟内存大小。")]),s._v(" "),a("blockquote",[a("p",[s._v("修改：vim /etc/sysctl.conf\n增加配置：vm.max_map_count=655360\n配置生效：sysctl -p\n配置查看：sysctl -a")])]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("[max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]")]),s._v(" "),a("p",[s._v("或者  max number of threads is too low 之类的意思是线程数不够。")])])]),s._v(" "),a("p",[s._v("修改非root用户线程不限制。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/security/limits.d/20-nproc.conf\n\n*          soft    nproc     unlimited\nroot       soft    nproc     unlimited\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[a("p",[s._v("报错提示内存不足：")]),s._v(" "),a("p",[s._v("Java HotSpot(TM) 64-Bit Server VM warning: INFO: os::commit_memory(0x00000000c5330000, 986513408, 0) failed; error='Cannot allocate memory' (errno=12)")]),s._v(" "),a("p",[s._v("修改配置 "),a("code",[s._v("jvm.options")]),s._v("，把默认的4g内存下调到1g。")]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("-Xms1g\n-Xmx1g\n")])])])])]),s._v(" "),a("h3",{attrs:{id:"_4-测试启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-测试启动","aria-hidden":"true"}},[s._v("#")]),s._v(" 4.测试启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9200\n")])])]),a("p",[s._v("或则设置好防火墙端口后web页面直接请求。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://blog-07.oss-cn-guangzhou.aliyuncs.com/picBak/1553346121339.png",alt:"1553346121339.png"}})]),s._v(" "),a("p",[s._v("一步到位命令，执行完重启机器")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\nsystemctl status firewalldulimit -c unlimited\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" -SHn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ulimit -SHn 65536"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/rc.local\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* soft nofile unlimited"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/security/limits.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* hard nofile unlimited"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/security/limits.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* soft nproc unlimited"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/security/limits.d/90-nproc.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* hard nproc unlimited"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/security/limits.d/90-nproc.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vm.max_map_count = 655360"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/etc/sysctl.conf\n/sbin/sysctl -p\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);