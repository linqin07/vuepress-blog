(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{289:function(n,t,e){"use strict";e.r(t);var s=e(2),r=Object(s.a)({},(function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("p",[n._v("ES6.3")]),n._v(" "),e("p",[n._v("应用场景为：重写入轻查询")]),n._v(" "),e("ol",[e("li")]),n._v(" "),e("p",[n._v("关闭swap分区\nswapoff -a  临时生效\nvim /etc/fstab\t永久生效")]),n._v(" "),e("ol",{attrs:{start:"2"}},[e("li")]),n._v(" "),e("p",[n._v("内存设置不建议超过32G：\n对于大内存主机设备，ES JVM内存建议不要超过32G，配置为31G即可")]),n._v(" "),e("ol",{attrs:{start:"3"}},[e("li")]),n._v(" "),e("p",[n._v("更换默认垃圾回收器（默认回收器为CMS）\n原配置：\n-XX:+UseConcMarkSweepGC\n-XX:CMSInitiatingOccupancyFraction=75\n-XX:+UseCMSInitiatingOccupancyOnly\n改为：\n-XX:+UseG1GC\n-XX:G1HeapRegionSize=32M")]),n._v(" "),e("p",[n._v("注释：使用G1回收器时，建议JDK版本大于1.8_131；\n目前甜橙使用版本：1.8_201")]),n._v(" "),e("ol",{attrs:{start:"4"}},[e("li")]),n._v(" "),e("p",[n._v("设置合理的分片数，建议单个分片大小控制在30GB左右\n比如数据量为1Tb的索引，建议分片数量控制在35个左右为佳")]),n._v(" "),e("ol",{attrs:{start:"5"}},[e("li")]),n._v(" "),e("p",[n._v('按需设置副本数，如数据不重要，可考虑不设副本；\nPUT /索引名称/_settings\n{\n"index": {\n"number_of_replicas": "0"\n}\n}')]),n._v(" "),e("ol",{attrs:{start:"6"}},[e("li")]),n._v(" "),e("p",[n._v("写入线程池优化：\nthread_pool.write.size: 65（默认为CPU核数，最大为cpu核数+1）\nthread_pool.write.queue_size: 1000（默认为200，建议调整为最大1000）")]),n._v(" "),e("ol",{attrs:{start:"7"}},[e("li")]),n._v(" "),e("p",[n._v("调整index buffer的大小（默认为jvm内存的10%）\nindices.memory.index_buffer_size: 25%")]),n._v(" "),e("ol",{attrs:{start:"8"}},[e("li")]),n._v(" "),e("p",[n._v('调整index.refresh_interval时间\nPUT /索引名称/_settings\n{\n"settings": {\n"refresh_interval": "120s"\n}\n}')]),n._v(" "),e("ol",{attrs:{start:"9"}},[e("li")]),n._v(" "),e("p",[n._v('调整Translog配置：\nPUT /索引名称/_settings\n{\n"index.translog.durability" : "async",\t\n"index.translog.flush_threshold_size" : "1024mb",\n"index.translog.sync_interval" : "120s"\n}')]),n._v(" "),e("p",[n._v('注："index.translog.sync_interval" : "120s"  此参数无法调整正在写入的索引，需先将索引关闭后方可配置；\n关闭索引：\nPOST /索引名称/_CLOSE\n开启索引：\nPOST /索引名称/_OPEN')]),n._v(" "),e("ol",{attrs:{start:"10"}},[e("li")]),n._v(" "),e("p",[n._v('调整Segment Merge操作：\nPUT /索引名称/_settings\n{\n"index.merge.policy.max_merged_segment": "2gb",\n"index.merge.scheduler.max_thread_count": 5,\n”index.merge.policy.max_merge_at_once": 30,\n"index.merge.policy.segments_per_tier": 30\n}')]),n._v(" "),e("ol",{attrs:{start:"11"}},[e("li")]),n._v(" "),e("p",[n._v("横向扩展数据节点：\n对于大资源主机，内存超过128G的主机而言\n建议充分利用起性能，可部署多实例（数据节点）；\n建议加上以下配置：\ncluster.routing.allocation.same_shard.host: true\ncluster.routing.allocation.cluster_concurrent_rebalance: 10\ncluster.routing.allocation.node_concurrent_recoveries: 10")]),n._v(" "),e("p",[n._v('##设置恢复速率（默认为2GB）：\nPUT _cluster/settings\n{\n"persistent": {\n"indices.recovery.max_bytes_per_sec": "10240m"\n}\n}')]),n._v(" "),e("ol",{attrs:{start:"12"}},[e("li")]),n._v(" "),e("p",[n._v("拆分大索引\n对于大数据量的索引（2T），建议拆分为多个小索引；\n按日切割或者按小时切割；")]),n._v(" "),e("ol",{attrs:{start:"13"}},[e("li")]),n._v(" "),e("p",[n._v("增大每批次入库数据量，这个量大小需要不断调整，太大不好，太小也好；\n甜橙单个server每批次入库数量为6000")]),n._v(" "),e("p",[n._v('最终配置：\n"index.translog.durability" : "async"\n"index.translog.flush_threshold_size" : "1024mb"\n"index.translog.sync_interval" : "120s"\n"index.merge.policy.max_merged_segment": "2gb"\n"index.translog.sync_interval" : "120s"')])])}),[],!1,null,null,null);t.default=r.exports}}]);