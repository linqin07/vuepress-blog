(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{303:function(s,a,t){"use strict";t.r(a);var e=t(2),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令","aria-hidden":"true"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),t("h3",{attrs:{id:"日志组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志组","aria-hidden":"true"}},[s._v("#")]),s._v(" 日志组")]),s._v(" "),t("ul",[t("li",[t("h6",{attrs:{id:"查看日志组列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看日志组列表","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看日志组列表")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-consumer-groups.sh --new-consumer --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092 --list\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"删除组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除组","aria-hidden":"true"}},[s._v("#")]),s._v(" 删除组")])])]),s._v(" "),t("p",[s._v("组还在使用删除会报错")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-consumer-groups.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".32.188:9092 --group mygroup --delete\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"查看堆积"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看堆积","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看堆积")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-consumer-groups.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".13.25:9092 --group mygroup --describe\n")])])]),t("h3",{attrs:{id:"topic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#topic","aria-hidden":"true"}},[s._v("#")]),s._v(" topic")]),s._v(" "),t("ul",[t("li",[t("h6",{attrs:{id:"查看-topic-内消息数目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看-topic-内消息数目","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看 topic 内消息数目")])])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./bin/kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".13.33:9092  --topic  mytopic --time -1 --offsets "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{sum += "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("} END {print sum}'")]),s._v("\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"动态修改队列数据保存时间ms（不用重启）默认7天-604800000"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#动态修改队列数据保存时间ms（不用重启）默认7天-604800000","aria-hidden":"true"}},[s._v("#")]),s._v(" 动态修改队列数据保存时间ms（不用重启）默认7天 604800000")])])]),s._v(" "),t("p",[s._v("修改后数据就保存时间短了。不会消费之前的数据。但是查看堆积还是有那么多数据量的。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" ./bin/kafka-topics.sh --zookeeper "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2181 -topic "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --alter --config retention.ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"producer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#producer","aria-hidden":"true"}},[s._v("#")]),s._v(" producer:")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-console-producer.sh --broker-list localhost:9092 --topic "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"comsumer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#comsumer","aria-hidden":"true"}},[s._v("#")]),s._v(" comsumer:")])])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" --from-beginning\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"重置偏移量："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重置偏移量：","aria-hidden":"true"}},[s._v("#")]),s._v(" 重置偏移量：")])])]),s._v(" "),t("p",[s._v("停止消费者，将消费组所有分区的位移调整为为最新位移")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./bin/kafka-consumer-groups.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.81:9092,192.168.100.82:9092 --group mygroup --reset-offsets --all-topics --to-latest --execute\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"删除topic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除topic","aria-hidden":"true"}},[s._v("#")]),s._v(" 删除topic")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-topics.sh --delete --zookeeper localhost:2181 --topic "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"创建topic：或者直接查看，其他参数就默认。也会新建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建topic：或者直接查看，其他参数就默认。也会新建","aria-hidden":"true"}},[s._v("#")]),s._v(" 创建topic：或者直接查看，其他参数就默认。也会新建")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --partitions "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" --topic "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"查看topic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看topic","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看topic")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-topics.sh --list --zookeeper localhost:2181\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"删除topic-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除topic-2","aria-hidden":"true"}},[s._v("#")]),s._v(" 删除topic")])])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./kafka-topics.sh --zookeeper node1:2181 --delete --topic "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])])]),t("h3",{attrs:{id:"分区迁移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分区迁移","aria-hidden":"true"}},[s._v("#")]),s._v(" 分区迁移")]),s._v(" "),t("p",[s._v("针对扩容或则缩容，对应调整一下分区ID即可，json文件设置处理的 topic")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"topics"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mytopic"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),t("p",[s._v("迁移命令")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-reassign-partitions.sh --zookeeper "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".32.187:2181 --topics-to-move-json-file topic.json  --broker-list "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1，2，3，4，5"')]),s._v(" --generate\n")])])]),t("p",[s._v("查看结果，可以 grep 一下结果 success 对比一下设置的分区知道执行百分比")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./bin/kafka-reassign-partitions.sh --zookeeper "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".32.187:2181 --reassignment-json-file topic.json  --verify  \n")])])]),t("p",[s._v("取消迁移")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ bin/kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".2.225:2181 --broker "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${brokerId}")]),s._v(" --num.retries "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" --retry.interval.ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" \n")])])]),t("h3",{attrs:{id:"启动配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 启动配置")]),s._v(" "),t("ul",[t("li",[t("h6",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动","aria-hidden":"true"}},[s._v("#")]),s._v(" 启动")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-server-start.sh config/server.properties\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /root/linqin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" ./bin/kafka-server-start.sh ./config/server.properties "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kafka.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"停止："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#停止：","aria-hidden":"true"}},[s._v("#")]),s._v(" 停止：")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kafka-server-stop.sh ./config/server.properties \n")])])]),t("ul",[t("li",[t("h6",{attrs:{id:"集群配置："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群配置：","aria-hidden":"true"}},[s._v("#")]),s._v(" 集群配置：")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("config/server-1.properties:\n    broker.id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listeners")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PLAINTEXT://:9093\n    log.dirs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/kafka-logs-1\n\nconfig/server-2.properties:\n    broker.id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listeners")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PLAINTEXT://:9094\n    log.dirs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/kafka-logs-2\n")])])]),t("h3",{attrs:{id:"定时打印消费数目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定时打印消费数目","aria-hidden":"true"}},[s._v("#")]),s._v(" 定时打印消费数目")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" bin/kafka-consumer-groups.sh --describe --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.29")]),s._v(".87.20:9092 --group topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$5")]),s._v("}'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" -v "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LAG"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{sum+="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}END{print sum}'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" ------ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);