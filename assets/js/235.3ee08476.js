(window.webpackJsonp=window.webpackJsonp||[]).push([[235],{629:function(s,a,t){"use strict";t.r(a);var e=t(20),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h6",{attrs:{id:"_1-二进制文件安装方式的配置文件。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-二进制文件安装方式的配置文件。"}},[s._v("#")]),s._v(" 1.二进制文件安装方式的配置文件。")]),s._v(" "),a("p",[s._v("一般都在  "),a("code",[s._v("/etc/my.cnf")]),s._v(" 这个路径下。")]),s._v(" "),a("h6",{attrs:{id:"_2-添加错误日志启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加错误日志启动"}},[s._v("#")]),s._v(" 2.添加错误日志启动")]),s._v(" "),a("p",[a("code",[s._v("#vim /etc/my.cnf")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("log_error "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/log/mysql/error.log\n")])])]),a("p",[s._v("回头创建目录mysql：到"),a("code",[s._v("var/log")]),s._v("里面创建mysql文件夹：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" mysql\n")])])]),a("h6",{attrs:{id:"_3-定位慢查询和不使用索引的查询-查看版本的sql-select-version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-定位慢查询和不使用索引的查询-查看版本的sql-select-version"}},[s._v("#")]),s._v(" 3.定位慢查询和不使用索引的查询 查看版本的sql:"),a("code",[s._v("select version();")])]),s._v(" "),a("p",[s._v("[mysqlld]"),a("br"),s._v("\nlong_query_time=2")]),s._v(" "),a("p",[s._v("查看mysql版本：mysql --version\n#5.0、5.1等版本配置如下选项"),a("br"),s._v('\nlog-slow-queries="mysql_slow_query.log"')]),s._v(" "),a("p",[s._v("#5.5及以上版本配置如下选项  修改my.cnf vim /etc/my.cnf")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("下\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启日志记录")]),s._v("\nslow-query-log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log_file")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql/mysql_slow_query.log\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义时间超过1s为慢查询")]),s._v("\nlong_query_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#未使用索引项")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_queries_not_using_indexes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),a("p",[s._v("开启："),a("code",[s._v("set global slow_query_log=1")]),s._v("; （重启失效）")]),s._v(" "),a("h6",{attrs:{id:"_4-验证慢查询是否开启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-验证慢查询是否开启"}},[s._v("#")]),s._v(" 4..验证慢查询是否开启")]),s._v(" "),a("p",[s._v("/*查看慢查询时间 */")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"long_query_time"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("默认"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("s  \n")])])]),a("p",[s._v("/*查看慢查询配置情况 */")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%slow_queries%"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n")])])]),a("p",[s._v("/*查看慢查询日志路径 */")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%slow%"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n")])])]),a("h6",{attrs:{id:"_5-执行一下慢查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-执行一下慢查询"}},[s._v("#")]),s._v(" 5.执行一下慢查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" SLEEP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("通过如下sql语句，来查看一共执行过几次慢查询：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%slow%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);