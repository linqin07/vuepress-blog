(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{501:function(s,a,e){"use strict";e.r(a);var t=e(20),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"redis-知识总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-知识总结"}},[s._v("#")]),s._v(" Redis 知识总结")]),s._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("h4",{attrs:{id:"_1-下载源码并解压"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载源码并解压"}},[s._v("#")]),s._v(" 1.下载源码并解压")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://download.redis.io/releases/redis-4.0.10.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xzf")]),s._v(" redis-4.0.10.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis-4.0.10\n")])])]),a("h4",{attrs:{id:"_2-编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-编译"}},[s._v("#")]),s._v(" 2.编译")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc gcc-c++ kernel-devel\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])])]),a("p",[s._v("等待编译完成")]),s._v(" "),a("h4",{attrs:{id:"_3-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装"}},[s._v("#")]),s._v(" 3.安装")]),s._v(" "),a("p",[a("code",[s._v("PREFIX")]),s._v(" 要大写，安装后的文件列表如下")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("redis-benchmark")]),s._v("  性能测试工具")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("redis-check-aof")]),s._v("  日志文件检测工(比如断电造成日志损坏,可以检测并修复)")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("redis-check-dump")]),s._v("  快照文件检测工具,效果类上")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("redis-cli")]),s._v("  客户端")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("redis-server")]),s._v(" 服务端")])])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PREFIX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/redis "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n// 复制到指定地方\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/redis/etc/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" redis.conf /usr/local/redis/etc/\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/redis/bin/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" redis-benchmark redis-cli redis-server /usr/bin/\n")])])]),a("h4",{attrs:{id:"_4-更改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-更改配置"}},[s._v("#")]),s._v(" 4.更改配置")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/redis/etc/redis.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改一下配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis以守护进程的方式运行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# no表示不以守护进程的方式运行(会占用一个终端)  ")]),s._v("\ndaemonize "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端闲置多长时间后断开连接，默认为0关闭此功能                                      ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置redis日志级别，默认级别：notice                    ")]),s._v("\nloglevel verbose\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 设置日志文件的输出方式,如果以守护进程的方式运行redis 默认:"" ')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并且日志输出设置为stdout,那么日志信息就输出到/dev/null里面去了 ")]),s._v("\nlogfile stdout\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置密码授权")]),s._v("\nrequirepass "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("设置密码"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听ip")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 \nport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n")])])]),a("h3",{attrs:{id:"启停"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启停"}},[s._v("#")]),s._v(" 启停")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动")]),s._v("\n./redis-server redis.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止")]),s._v("\n./redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n")])])]),a("h2",{attrs:{id:"cluster-集群搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cluster-集群搭建"}},[s._v("#")]),s._v(" Cluster 集群搭建")]),s._v(" "),a("h3",{attrs:{id:"_1-复制6份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-复制6份"}},[s._v("#")]),s._v(" 1.复制6份")]),s._v(" "),a("p",[s._v("复制上面单机配置6份（bin下面所有文件），分别定义为 redis01~redis06，修改端口为 7001~7006 , 注意要删除掉日志、rbd 文件、如果重置 redis 集群也要把生成的 node.conf 删除掉。")]),s._v(" "),a("h3",{attrs:{id:"_2-用脚本启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-用脚本启动"}},[s._v("#")]),s._v(" 2.用脚本启动")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis01\n./redis-server redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis02\n./redis-server redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis03\n./redis-server redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis04\n./redis-server redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis05\n./redis-server redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis06\n./redis-server redis.conf\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])])]),a("p",[s._v("查看进程可以知道已经启动了 ps -ef|grep redis")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("root      32149      1  0 20:47 ?        00:00:00 ./redis-server 192.168.233.128:7001 [cluster]\nroot      32151      1  0 20:47 ?        00:00:00 ./redis-server 192.168.233.128:7002 [cluster]\nroot      32159      1  0 20:47 ?        00:00:00 ./redis-server 192.168.233.128:7003 [cluster]\nroot      32164      1  0 20:47 ?        00:00:00 ./redis-server 192.168.233.128:7004 [cluster]\nroot      32166      1  0 20:47 ?        00:00:00 ./redis-server 192.168.233.128:7005 [cluster]\nroot      32171      1  0 20:47 ?        00:00:00 ./redis-server 192.168.233.128:7006 [cluster]\n")])])]),a("h3",{attrs:{id:"_3-节点握手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-节点握手"}},[s._v("#")]),s._v(" 3.节点握手")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7001 cluster meet 192.168.233.128 7001")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7001 cluster meet 192.168.233.128 7002")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7001 cluster meet 192.168.233.128 7003")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7001 cluster meet 192.168.233.128 7004")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7001 cluster meet 192.168.233.128 7005")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7001 cluster meet 192.168.233.128 7006")]),s._v("\nOK\n")])])]),a("p",[s._v("查看节点信息")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ./redis01/redis-cli -h "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" cluster nodes\nd8d281eb8ee004bd8815eb4c716b62a224ba4894 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7005")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17005")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286224000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" connected\n60ba0e2ad7c165b9fb174afadb1c2c75f2a69f72 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17003")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286226164")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" connected\n1a21b9407d2ad75836c803f9aa927036f60f51c4 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17001")]),s._v(" myself"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286225000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" connected\n532f83128e65e006954b43c6cb4be59c93dbe645 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17002")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286225157")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" connected\na9def6e64b78e0b205876783fa62065dca307ea3 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7006")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17006")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286224000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" connected\n12ebb0e51c956f6f7d0335add17c21b42f5a7add "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17004")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286224150")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" connected\n")])])]),a("h3",{attrs:{id:"_4-分配槽"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-分配槽"}},[s._v("#")]),s._v(" 4.分配槽")]),s._v(" "),a("p",[s._v("我们把 7001、7003、7005 端口的节点作为主节点，负责处理槽和相关数据；7002、7004、7006 端口的节点分别作为从节点，负责故障转移。先把16384个槽平均分配给6380、6382、6384端口的节点，为节点分配槽是通过"),a("code",[s._v("cluster addslots")]),s._v(" 命令实现：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7001 cluster addslots {0..5461}     ")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7003 cluster addslots {5462..10922}")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7005 cluster addslots {10923..16383}")]),s._v("\nOK\n")])])]),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ./redis01/redis-cli -h "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" cluster nodes\n700616e39189f9eb2ad8f4e01677fd0d6e66a52e "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7006")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17006")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286775000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" connected\n37b63b1cf822420c231ce512196e8161a53b2b78 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17003")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286774000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-10922")]),s._v("\nd437d0c43c9eb6d4753269ae9774ea3dc9c6b189 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17002")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286776691")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" connected\n4d11ed7dff78760368281927092e36bb10249237 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17001")]),s._v(" myself"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286773000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-5461")]),s._v("\ne98628877ddb0b27dfdbdda96e45d0e9e690b7f8 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7005")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17005")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286775685")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-16383")]),s._v("\na6a1e1655b315b6dafaead630ef6ecbadc20ac01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17004")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286774000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" connected\n")])])]),a("p",[s._v("再使用cluster replicate命令把一个节点变成从节点.，这个命令必须在从节点上运行，它的语法是：")]),s._v(" "),a("p",[s._v("cluster replicate 主节点ID")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7002 cluster replicate 4d11ed7dff78760368281927092e36bb10249237  ")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7004 cluster replicate 37b63b1cf822420c231ce512196e8161a53b2b78")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis01/redis-cli -h 192.168.233.128 -p 7006 cluster replicate e98628877ddb0b27dfdbdda96e45d0e9e690b7f8")]),s._v("\nOK\n")])])]),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis_cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ./redis01/redis-cli -h "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" cluster nodes\n700616e39189f9eb2ad8f4e01677fd0d6e66a52e "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7006")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17006")]),s._v(" slave e98628877ddb0b27dfdbdda96e45d0e9e690b7f8 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286933763")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" connected\n37b63b1cf822420c231ce512196e8161a53b2b78 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17003")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286931751")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-10922")]),s._v("\nd437d0c43c9eb6d4753269ae9774ea3dc9c6b189 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17002")]),s._v(" slave 4d11ed7dff78760368281927092e36bb10249237 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286931000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" connected\n4d11ed7dff78760368281927092e36bb10249237 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17001")]),s._v(" myself"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286931000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-5461")]),s._v("\ne98628877ddb0b27dfdbdda96e45d0e9e690b7f8 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7005")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17005")]),s._v(" master - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286930000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" connected "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-16383")]),s._v("\na6a1e1655b315b6dafaead630ef6ecbadc20ac01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("233.128")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17004")]),s._v(" slave 37b63b1cf822420c231ce512196e8161a53b2b78 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1650286932755")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" connected\n")])])]),a("p",[s._v("亲测分配槽 7001 7002 7003，无法设置从节点 7004 7005 7006，但是间隔可以成功。")]),s._v(" "),a("p",[s._v("上面分配槽 7001 7003 7005，可以设置从节点 7002 7004 7006")]),s._v(" "),a("h3",{attrs:{id:"_5-停止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-停止"}},[s._v("#")]),s._v(" 5.停止")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".233.128 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n./redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".233.128 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n./redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".233.128 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n./redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".233.128 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7004")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n./redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".233.128 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7005")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n./redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".233.128 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7006")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n")])])]),a("p",[s._v("或则直接kill掉进程")]),s._v(" "),a("h2",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/Jtianlin/p/10259062.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("知识点"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"登陆客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登陆客户端"}},[s._v("#")]),s._v(" 登陆客户端")]),s._v(" "),a("p",[s._v("使用密码， 集群模式不可以选择数据库，默认使用0数据库， 同时登录命令需要加上"),a("code",[s._v("-c")]),s._v("参数")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("./redis-cli\nauth "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\n或者\n./redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" myPassword\n选择数据库\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n集群模式\n./bin/redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".33.60 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" pwd123456\n")])])]),a("h4",{attrs:{id:"列表查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列表查询"}},[s._v("#")]),s._v(" 列表查询")]),s._v(" "),a("p",[s._v("生产勿用，可以使用通配符：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("keys mykey*\n\n集群模式,不能去掉"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("换成你redis集群的一个节点的ip和端口，需要在只能分片的槽上面才可以看keys\n./redis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" pwd123456 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" call "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".168.161:7001 keys "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("*\n")])])]),a("h4",{attrs:{id:"get-set操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#get-set操作"}},[s._v("#")]),s._v(" get/set操作")]),s._v(" "),a("p",[s._v("删除  del key1 key2")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("字符串类型：")]),s._v(" "),a("p",[s._v("ttl key\nEXPIRE key 30")])])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v(" // 单个get、set\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key value ex "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n get key\n")])])]),a("ul",[a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/305e65de1b13",target:"_blank",rel:"noopener noreferrer"}},[s._v("bitmap"),a("OutboundLink")],1)])]),s._v(" "),a("h4",{attrs:{id:"查询连接数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询连接数"}},[s._v("#")]),s._v(" 查询连接数")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("// 查询整个客户端的链接数\nredis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.105")]),s._v(".x.x "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v(" info clients\n// 直接查看链接tcp数目，精确到database\nredis-cli "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.105")]),s._v(".x.x "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v("  client list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db=11'")]),s._v("\n")])])]),a("h2",{attrs:{id:"redis键-key-操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis键-key-操作"}},[s._v("#")]),s._v(" Redis键(key)操作")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("set k1 a` ---\x3e`key:k1 ; value:a\nset k2 b\n")])])]),a("ul",[a("li",[a("p",[a("code",[s._v("keys *")]),s._v(" \t查看当前库所有skey")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("exists key")]),s._v("\t 判断某个key是否存在  --\x3e"),a("code",[s._v("exists k1")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("type key")]),s._v(" \t\t查看你的key是什么类型  --\x3e"),a("code",[s._v("type k1")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("del key")]),s._v(" \t删除指定的key数据 --\x3e"),a("code",[s._v("del k1")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("unlink key")]),s._v("根据value选择非阻塞删除仅将keys从keyspace元数据中删除，真正的删除会在后续异步操作。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("expire key 10")]),s._v(" \t10秒钟：为给定的key设置过期时间 --\x3e"),a("code",[s._v("expire k2 10")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("ttl key")]),s._v("\t\t查看还有多少秒过期，-1表示永不过期，-2表示已过期  --\x3e"),a("code",[s._v("ttl k2")])])])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("// 不存在就设置成功，否则设置失败\nsetnx key value\nexpire key "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n// 不存在设置，顺便设置过期时间，等同于上面两条的原子操作\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" lock:168 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nx ex "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n\n\n")])])]),a("h2",{attrs:{id:"高并发下的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高并发下的问题"}},[s._v("#")]),s._v(" 高并发下的问题")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("缓存穿透")]),s._v(" "),a("p",[s._v("直接请求没有命中符合的数据，频繁的直接查数据库。解决方案一是直接把空对象缓存起来，设置好 ttl，二是使用布隆过滤器，核心就是 bitmap 这个数据结构，使用位表示是否存在。")])]),s._v(" "),a("li",[a("p",[s._v("缓存击穿")]),s._v(" "),a("p",[s._v("如果缓存中的数据在某个时刻批量过期，导致大部分用户的请求都会直接落在数据库上，这种现象就叫作缓存击穿")]),s._v(" "),a("p",[s._v("解决一是动态设置ttl过期时间，二是使用分布式锁保证每个key同时只有一个线程去查询后端服务。")])]),s._v(" "),a("li",[a("p",[s._v("缓存雪崩")]),s._v(" "),a("p",[s._v("。数据存储层的调用量就会暴增，用不了多长时间，数据库就会被大流量压垮，这种级联式的服务故障，就叫作缓存雪崩。")]),s._v(" "),a("p",[s._v("解决一是保证 redis 集群高可用，二是控制好限流操作。比如 nginx 限流。")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);