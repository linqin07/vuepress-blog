(window.webpackJsonp=window.webpackJsonp||[]).push([[219],{443:function(s,a,t){"use strict";t.r(a);var e=t(2),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h6",{attrs:{id:"_1-二进制文件安装方式的配置文件。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-二进制文件安装方式的配置文件。","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.二进制文件安装方式的配置文件。")]),s._v(" "),t("p",[s._v("一般都在  "),t("code",[s._v("/etc/my.cnf")]),s._v(" 这个路径下。")]),s._v(" "),t("h6",{attrs:{id:"_2-添加错误日志启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加错误日志启动","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.添加错误日志启动")]),s._v(" "),t("p",[t("code",[s._v("#vim /etc/my.cnf")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("log_error "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/log/mysql/error.log\n")])])]),t("p",[s._v("回头创建目录mysql：到"),t("code",[s._v("var/log")]),s._v("里面创建mysql文件夹：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" mysql\n")])])]),t("h6",{attrs:{id:"_3-定位慢查询和不使用索引的查询-查看版本的sql-select-version"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-定位慢查询和不使用索引的查询-查看版本的sql-select-version","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.定位慢查询和不使用索引的查询 查看版本的sql:"),t("code",[s._v("select version();")])]),s._v(" "),t("p",[s._v("[mysqlld]"),t("br"),s._v("\nlong_query_time=2")]),s._v(" "),t("p",[s._v("查看mysql版本：mysql --version\n#5.0、5.1等版本配置如下选项"),t("br"),s._v('\nlog-slow-queries="mysql_slow_query.log"')]),s._v(" "),t("p",[s._v("#5.5及以上版本配置如下选项  修改my.cnf vim /etc/my.cnf")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("下\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启日志记录")]),s._v("\nslow-query-log"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql/mysql_slow_query.log\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义时间超过1s为慢查询")]),s._v("\nlong_query_time "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#未使用索引项")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_queries_not_using_indexes")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("开启："),t("code",[s._v("set global slow_query_log=1")]),s._v("; （重启失效）")]),s._v(" "),t("h6",{attrs:{id:"_4-验证慢查询是否开启"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-验证慢查询是否开启","aria-hidden":"true"}},[s._v("#")]),s._v(" 4..验证慢查询是否开启")]),s._v(" "),t("p",[s._v("/*查看慢查询时间 */")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"long_query_time"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("默认"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("s  \n")])])]),t("p",[s._v("/*查看慢查询配置情况 */")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%slow_queries%"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n")])])]),t("p",[s._v("/*查看慢查询日志路径 */")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%slow%"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n")])])]),t("h6",{attrs:{id:"_5-执行一下慢查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-执行一下慢查询","aria-hidden":"true"}},[s._v("#")]),s._v(" 5.执行一下慢查询")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" SLEEP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("通过如下sql语句，来查看一共执行过几次慢查询：")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%slow%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);