(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{291:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/cluster-allocation-explain.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网文档"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"_1-查看索引解释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查看索引解释","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.查看索引解释")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/_cluster/allocation/explain?pretty"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n  "index": "myindex",\n  "shard": 0,\n  "primary": true\n}\n\'')]),s._v("\n\n")])])]),a("p",[s._v("返回结果有对应的 explanation 查看对应的原因。")]),s._v(" "),a("p",[s._v("查询某个索引内容")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"localhost:9200/indexName/_search -H 'Content-Type: application/json' -d'\n{\n\t\"")]),s._v("from"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('": 0,\n\t"')]),s._v('size": '),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n'\n")])])]),a("h4",{attrs:{id:"_2-查看-cat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看-cat","aria-hidden":"true"}},[s._v("#")]),s._v(" 2."),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/7.9/cat.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("查看 _cat"),a("OutboundLink")],1)]),s._v(" "),a("h5",{attrs:{id:"查看集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看集群","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看集群")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/_cat/master?v&pretty"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/_cat/master?help"')]),s._v("\n查看帮助\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/_cat/master?help&pretty"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/_cat/indices?bytes=b&s=store.size:desc&v&pretty"')]),s._v("\n")])])]),a("p",[s._v("提供有关为每个数据节点分配了多少分片以及它们正在使用多少磁盘空间的快照")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("get _cat/allocation?v\nget _cat/allocation?v"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("s")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET “lalhost:9200/_cat/allocation?v"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("pretty”\n")])])]),a("h5",{attrs:{id:"查看索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看索引","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看索引")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("过滤基于时间的索引：\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -s localhost:9200/_cat/indices?h"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018.11")]),s._v(".11 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/111\n确认下索引：\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/111\n批量关闭索引：\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/111"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPOST localhost:9200/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v("/_close"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),a("h5",{attrs:{id:"查看索引状态："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看索引状态：","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看索引状态：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("命令行：\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XGET ‘localhost:9200/_cat/indices?v"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("pretty’\n浏览器：\nhttp://localhost:9200/_cat/indices?v"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("pretty\n")])])]),a("h5",{attrs:{id:"查看分片信息："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看分片信息：","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看分片信息：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("查看未分配的分片\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XGET localhost:9200/_cat/shards?h"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("index,shard,prirep,state,unassigned.reason"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" UNASSIGNED\n")])])]),a("h5",{attrs:{id:"查看segment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看segment","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看segment:")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/7.9/indices-forcemerge.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("查看官网文档API"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("ES 的 data node 存储数据并非只是耗费磁盘空间的，为了加速数据的访问，每个 segment 都有会一些索引数据驻留在 heap 里。因此 segment 越多，瓜分掉的 heap 也越多，并且这部分 heap 是无法被 GC 掉的！")]),s._v(" "),a("ul",[a("li",[s._v("删除不用的索引")]),s._v(" "),a("li",[s._v("关闭索引 （文件仍然存在于磁盘，只是释放掉内存）。需要的时候可以重新打开。")]),s._v(" "),a("li",[s._v("force merge api，可以节省大量的 segment memory。")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("命令行：\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XGET ‘localhost:9200/_cat/segments?v’\n浏览器查看：\nhttp://localhost:9200/_cat/segments?v"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("h")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("shard,segment,size,size.memory"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("s")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("size:desc\n查看一个node上所有segment占用的memory总和\nhttp://localhost:9200/_cat/nodes?v"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("ip,heap.percent,name,sm\n强制合并：多个索引可以逗号\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/.ds-logs-000001/_forcemerge?max_num_segments=1&pretty"')]),s._v("\n控制合并资源\n\n\n")])])]),a("h5",{attrs:{id:"查看分片信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看分片信息","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看分片信息")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XGET http://localhost:9200/_cat/shards?v\n")])])]),a("h5",{attrs:{id:"查看索引信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看索引信息","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看索引信息")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XGET http://localhost:9200/_cat/indices?v\n")])])]),a("h5",{attrs:{id:"查看集群恢复信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看集群恢复信息","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看集群恢复信息")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://10.155.208.146:9200/_cat/recovery "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" north_rbet-zb-infolog2_2020w50\n")])])]),a("h5",{attrs:{id:"查看es插入完成拒绝数目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看es插入完成拒绝数目","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看es插入完成拒绝数目")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("http://192.168.13.25:9200/_cat/thread_pool/write?v"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("h")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("node_name,name,active,rejected,completed\n")])])]),a("h4",{attrs:{id:"_3-关闭集群路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-关闭集群路由","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.关闭集群路由")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("PUT _cluster/settings\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transient"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster.routing.rebalance.enable"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("cluster.routing.rebalance.enable\n为特定种类的分片启用或禁用重新平衡：")]),s._v(" "),a("p",[s._v("all -（默认）允许所有类型的分片进行分片平衡。")]),s._v(" "),a("p",[s._v("primaries -仅允许对主要分片进行分片平衡。")]),s._v(" "),a("p",[s._v("replicas -仅允许副本分片进行分片平衡。")]),s._v(" "),a("p",[s._v("none -任何索引都不允许任何形式的分片平衡。")]),s._v(" "),a("h4",{attrs:{id:"_4-复制旧索引到新集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-复制旧索引到新集群","aria-hidden":"true"}},[s._v("#")]),s._v(" 4. 复制旧索引到新集群")]),s._v(" "),a("p",[s._v("将以下配置参数添加到"),a("code",[s._v("新的")]),s._v(" 7.x Elasticsearch 集群的 elasticsearch.yml 文件，以支持其访问旧的 Elasticsearch 集群：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("reindex.remote.whitelist: oldhost:*\n")])])]),a("p",[s._v("将 "),a("code",[s._v("oldhost")]),s._v(" 替换为 Elasticsearch 主机。")]),s._v(" "),a("p",[s._v("不要指定 Elasticsearch 端口，但将值设为 *，否则可能收到以下错误消息："),a("code",[s._v('"[oldhost:9200] not whitelisted in reindex.remote.whitelist"')])]),s._v(" "),a("p",[s._v("重新启动 Elasticsearch 集群。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPOST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/_reindex"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{\n    "source": {\n        "remote": {\n            "host": "http://192.168.13.21:9200",\n            "username": "username",\n            "password": "pwd"\n        },\n        "index": "old_base_line_202004",\n        "query": {\n            "match_all": {}\n        }\n    },\n    "dest": {\n        "index": "new_base_line_202004"\n    }\n}\n\'')]),s._v("\n")])])]),a("h4",{attrs:{id:"_5-配置-es-支持跨集群搜索-cross-cluster-search"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置-es-支持跨集群搜索-cross-cluster-search","aria-hidden":"true"}},[s._v("#")]),s._v(" 5.配置 ES 支持跨集群搜索(Cross Cluster Search)")]),s._v(" "),a("p",[s._v("可以配置 elasticsearch.yml 或者动态使用 "),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/6.0/cluster-update-settings.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Cluster Settings API"),a("OutboundLink")],1),s._v(" 配置")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("使用配置的形式")]),s._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("south")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("seeds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9301")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("seeds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9302")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("north")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("seeds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9303")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("seeds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9304")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("使用命令设置")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPUT -H"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" localhost:9201/_cluster/settings -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'\n{\n    "persistent": {\n        "search.remote": {\n            "south": {\n                "skip_unavailable": "true",\n                "seeds": ["192.168.13.25:9300"]\n            },\n            "north": {\n                "skip_unavailable": "true",\n                "seeds": ["192.168.13.23:9300","192.168.13.100:9300"]\n            }\n        }\n    }\n}\'')]),s._v("\n")])])])])]),s._v(" "),a("h6",{attrs:{id:"查看文件大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看文件大小","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看文件大小")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://localhost:9200/_cluster/settings\n")])])]),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"persistent"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"search"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"remote"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"south"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"skip_unavailable"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"seeds"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.13.25:9300"')]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"north"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"skip_unavailable"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"seeds"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.13.23:9300"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.13.100:9300"')]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"transient"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("然后搜索可以直接使用索引拼接集群前缀的方式进行请求数据，如"),a("code",[s._v("south:xxxIndex")]),s._v("，搜索数据可以，但是其他的一些 api 初始化客户端的时候因为往往只有一边的 es 集群，比如获取字段，获取其他数据只能有一半的数据，解决方案，在具体的获取客户端的时候获取远程 remote 的信息，再回头初始化多个客户端，对不同的集群索引进行分组使用对应的客户端进行请求，得到结果在合并到一起。")]),s._v(" "),a("h4",{attrs:{id:"_6-查看-task-任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-查看-task-任务","aria-hidden":"true"}},[s._v("#")]),s._v(" 6.查看 task 任务")]),s._v(" "),a("p",[s._v("http://188.4.15.119:9200/_tasks")]),s._v(" "),a("p",[s._v("http://188.4.15.119:9200/_cat/tasks")]),s._v(" "),a("p",[s._v("取消任务")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("POST _tasks/YhYJAf--Q0Wt7H-OTpLwBw:5895289684/_cancel\nPOST _tasks/_cancel?nodes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("node-320"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("actions")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("*search\nPOST _tasks/_cancel?actions"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("*search*\n")])])]),a("h4",{attrs:{id:"_7-es7-版本设置每个节点最大分片数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-es7-版本设置每个节点最大分片数","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.es7 版本设置每个节点最大分片数")]),s._v(" "),a("p",[s._v("elasticsearch7以上版本，默认只允许1000个分片，问题是因为集群分片数不足引起的,永久（Persistent）,临时（Transient）")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPUT -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type:application/json"')]),s._v(" http://localhost:9200/_cluster/settings -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"persistent":{"cluster":{"max_shards_per_node":2000}}}\'')]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);