(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{296:function(s,t,a){"use strict";a.r(t);var e=a(2),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"x-pack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-pack","aria-hidden":"true"}},[s._v("#")]),s._v(" x-pack")]),s._v(" "),a("h3",{attrs:{id:"查看-x-pack-license-信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-x-pack-license-信息","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看 x-pack license 信息")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("curl -u elastic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("Qc"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("lfkiGXYpUpeCpRwUy http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//192.168.10.145:9200/_xpack/license")]),s._v("\n返回\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"license"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"status"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"active"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"uid"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5b67e00a-fdc5-44cb-abf2-0ae058eb55c0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"platinum"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"issue_date"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2018-11-02T00:00:00.000Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"issue_date_in_millis"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1541116800000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"expiry_date"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2068-06-24T06:50:00.000Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"expiry_date_in_millis"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3107746200000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"max_nodes"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"issued_to"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Lin Qin (my-company)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"issuer"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Web Form"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start_date_in_millis"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1541116800000")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),a("h3",{attrs:{id:"破解-x-pack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#破解-x-pack","aria-hidden":"true"}},[s._v("#")]),s._v(" 破解 X-PACK")]),s._v(" "),a("p",[s._v("ES7 以上的版本不用破解了。")]),s._v(" "),a("h3",{attrs:{id:"x-pack认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-pack认证","aria-hidden":"true"}},[s._v("#")]),s._v(" x-pack认证")]),s._v(" "),a("p",[s._v("由于es6+版本集群认证要配置加密通信，"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/6.3/configuring-tls.html#node-certificates",target:"_blank",rel:"noopener noreferrer"}},[s._v("查看官网文档"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[s._v("生成认证文件 "),a("code",[s._v("elastic-certificates.p12")])])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("bin/elasticsearch-certutil ca\n")])])]),a("ul",[a("li",[a("p",[s._v("使用认证文件生成证书")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12\n")])])])]),s._v(" "),a("li",[a("p",[s._v("添加刚才输入的密码,会在 config 文件夹下生成 elasticseaerch.keystore 文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("bin/elasticsearch-keystore "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" xpack.security.transport.ssl.keystore.secure_password\nbin/elasticsearch-keystore "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" xpack.security.transport.ssl.truststore.secure_password\n")])])]),a("p",[s._v("复制 elastic-certificates.p12 到 config 文件夹下")])]),s._v(" "),a("li",[a("p",[s._v("真正起作用的是 config 文件夹下的 elasticseaerch.keystore 文件")]),s._v(" "),a("p",[s._v("拷贝 elastic-certificates.p12 和 elasticseaerch.keystore 到所有节点机器")])]),s._v(" "),a("li",[a("p",[s._v("导入license，可以申请")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPUT "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://192.168.10.145:9200/_xpack/license?acknowledge=true&pretty'")]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" -d @lin-qin-15837219-79c2-471c-b4c4-c69b4a151ec8-v5.json\n  // 返回\n% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1249")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("58")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1191")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("411")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8446")]),s._v(" --:--:-- --:--:-- --:--:--  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9992")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"acknowledged"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"license_status"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"valid"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])])]),s._v(" "),a("li",[a("p",[s._v("修改es配置，重启。没配置上面认证无法恢复集群数据。")]),s._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v(" es配置文件\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#xpack.license.self_generated.type: trial")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.ml.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置为trial（默认）以启用所有X-Pack功能,basic使用基础就可以了。: ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加如下2行,打开安全配置功能,文件目录默认是config文件夹: ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.verification_mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" certificate\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.keystore.path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("certificates.p12\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.truststore.path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("certificates.p12\n")])])])]),s._v(" "),a("li",[a("p",[s._v("查看集群健康状态，等集群恢复后可以执行y生成密码，记住密码。等恢复数据再次执行。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./bin/elasticsearch-setup-passwords auto -v\n")])])])]),s._v(" "),a("li",[a("p",[s._v("修改客户端代码支持ssl即可。"),a("a",{attrs:{href:"https://segmentfault.com/a/1190000022102940",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),a("OutboundLink")],1)])])]),s._v(" "),a("h3",{attrs:{id:"x-pack-生成密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-pack-生成密码","aria-hidden":"true"}},[s._v("#")]),s._v(" x-pack 生成密码")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("F:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("elasticsearch-6.3.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("elasticsearch-setup-passwords auto\nInitiating the setup of passwords "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" reserved "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" elastic,kibana,logstash_system,beats_system.\nThe passwords will be randomly generated and printed to the console.\nPlease confirm that you would like to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("y\n\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user kibana\nPASSWORD kibana "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" yi3GEYpR8JKZh1gfIii2\n\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user logstash_system\nPASSWORD logstash_system "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 7XFm6hT5Ljf2Bm3GM79c\n\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user beats_system\nPASSWORD beats_system "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" gpiuJUZuhKl6LAPEkz8L\n\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user elastic\nPASSWORD elastic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Qc6lfkiGXYpUpeCpRwUy\n")])])]),a("h3",{attrs:{id:"x-pack-修改密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-pack-修改密码","aria-hidden":"true"}},[s._v("#")]),s._v(" x-pack 修改密码")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type:application/json"')]),s._v(" -XPOST -u elastic "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://http://192.168.10.145:9200/_xpack/security/user/elastic/_password'")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{ "password" : "elastic" }\'')]),s._v("\n\n")])])]),a("h3",{attrs:{id:"去官网申请正式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#去官网申请正式","aria-hidden":"true"}},[s._v("#")]),s._v(" 去官网申请正式")]),s._v(" "),a("blockquote",[a("p",[s._v("https://license.elastic.co/registration "),a("code",[s._v("官网地址")])])]),s._v(" "),a("ol",[a("li",[s._v("邮箱认真写，用来接收json文件的")]),s._v(" "),a("li",[s._v("country写china,其它都可以随便写")]),s._v(" "),a("li",[s._v("点击申请后邮箱马上会收到一个邮件")]),s._v(" "),a("li",[s._v("修改 json 文件\n"),a("ul",[a("li",[s._v('“type”:“basic” 替换为 “type”:"'),a("code",[s._v("platinum")]),s._v('" # 基础版变更为铂金版')]),s._v(" "),a("li",[s._v("expiry_date_in_millis”:1561420799999 替换为 “expiry_date_in_millis”:"),a("code",[s._v("3107746200000")]),s._v("# 1年变为50年")]),s._v(" "),a("li",[s._v("好好保存，修改后的文件可以重复使用到其它 ES 服务器")])])])])])}),[],!1,null,null,null);t.default=r.exports}}]);