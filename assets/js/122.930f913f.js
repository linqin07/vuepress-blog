(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{348:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"将-nginx-做成服务并开机启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将-nginx-做成服务并开机启动","aria-hidden":"true"}},[s._v("#")]),s._v(" 将 nginx 做成服务并开机启动")]),s._v(" "),a("h4",{attrs:{id:"_1-制作启停脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-制作启停脚本","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.制作启停脚本")]),s._v(" "),a("p",[s._v("脚本例子，可以根据需求对应修改(PS: 脚本无 sh 后缀)")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#chkconfig: 2345 80 90")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#description:nginx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx程序路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginxd")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/nginx\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx配置文件路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx_config")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/nginx/conf/nginx.conf\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx pid文件的路径，可以在nginx的配置文件中找到")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx_pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/nginx/logs/nginx.pid\n\n"),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -e "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nginx_pid")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx already running...."')]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -n $"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Starting '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v(': "')]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nginxd")]),s._v("/sbin/nginx -c "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${nginx_config}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stop nginx daemons functions.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("stop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -n $"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stopping '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v(': "')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nginxd")]),s._v("/sbin/nginx -s stop\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reload nginx service functions.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("reload")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -n $"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Reloading '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v(': "')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nginxd")]),s._v("/sbin/nginx -s reload\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See how we were called.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\nstart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        start\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nstop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        stop\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nreload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        reload\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nrestart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        stop\n        start\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nstatus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("c_pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" /data/nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'grep'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NR==1{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$c_pid")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$c_pid")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stopped"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Running '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$c_pid")]),s._v('"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage: '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v(' {start|stop|restart|reload|status}"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),a("h4",{attrs:{id:"_2-软连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-软连接","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.软连接")]),s._v(" "),a("p",[a("code",[s._v("在")]),s._v("/etc/init.d"),a("code",[s._v("生成对应的软连接,")]),s._v("ln -s  目标  快捷方式目录`")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /data/nginx/nginx /etc/init.d/nginx\n")])])]),a("p",[s._v("这样就可以直接使用命令")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("start"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("stop"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("reload"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h4",{attrs:{id:"_3-开机自启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-开机自启动","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.开机自启动")]),s._v(" "),a("h5",{attrs:{id:"方式一："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式一：","aria-hidden":"true"}},[s._v("#")]),s._v(" 方式一：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("// 添加到开机列表里面\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --add nginx\n// 查看列表\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --list\n// nginx服务开机自启动 off 关闭\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" nginx on\n")])])]),a("p",[a("strong",[s._v("服务不支持 chkconfig")])]),s._v(" "),a("p",[s._v("#!/bin/bash")]),s._v(" "),a("p",[s._v("#chkconfig: 2345 80 90")]),s._v(" "),a("p",[s._v("#description:nginx")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("第一行，告诉系统使用的shell,所以的shell脚本都是这样。")])]),s._v(" "),a("li",[a("p",[s._v("第 二行，chkconfig 后面有三个参数 2345 80 90 告诉 chkconfig 程序，需要在 rc2.d~rc5.d 目录下，创建名字为 S80nginx的文件连接，连接到 /etc/rc.d/init.d 目录下的的 nginx 脚本。第一个字符是 S，系统在启动的时候，运行脚 本 nginx，就会添加一个 start 参数，告诉脚本，现在是启动模式。同时在 rc0.d 和 rc6.d 目录下，创建名字为 K90nginx 的 文件连接，第一个字符为 K，个系统在关闭系统的时候，会运行 nginx，添加一个 stop，告诉脚本，现在是关闭模式。\n注意上面的三行是中，地二，第三行是必须的，否则在运行 chkconfig --add nginx 时，会报错")])])]),s._v(" "),a("h5",{attrs:{id:"方式二："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式二：","aria-hidden":"true"}},[s._v("#")]),s._v(" 方式二：")]),s._v(" "),a("p",[s._v("直接编辑文件 "),a("code",[s._v("/etc/rc.local")]),s._v("，里面直接编辑执行命令。如果没有这个文件，创建并且赋权即可。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/rc.local\n")])])]),a("p",[s._v("然后把所需要开机自启的服务加载到最后面，例如加载 nginx 服务开机自启：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx start\n")])])]),a("p",[s._v("这样我们就能把服务设置为开机启动，启动的命令处理启动服务外，还能把需要的脚本加载到rc.local，实现开机自动执行脚本。")])])}),[],!1,null,null,null);t.default=e.exports}}]);