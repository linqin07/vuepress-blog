(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{235:function(a,e,t){"use strict";t.r(e);var r=t(2),n=Object(r.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"thread"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#thread","aria-hidden":"true"}},[a._v("#")]),a._v(" thread")]),a._v(" "),t("blockquote",[t("p",[a._v("查看当前线程信息，查看线程的堆栈")])]),a._v(" "),t("h2",{attrs:{id:"参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参数说明","aria-hidden":"true"}},[a._v("#")]),a._v(" 参数说明")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("参数名称")]),a._v(" "),t("th",[a._v("参数说明")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[t("em",[a._v("id")])]),a._v(" "),t("td",[a._v("线程id")])]),a._v(" "),t("tr",[t("td",[a._v("[n:]")]),a._v(" "),t("td",[a._v("指定最忙的前N个线程并打印堆栈")])]),a._v(" "),t("tr",[t("td",[a._v("[b]")]),a._v(" "),t("td",[a._v("找出当前阻塞其他线程的线程")])]),a._v(" "),t("tr",[t("td",[a._v("[i "),t("code",[a._v("<value>")]),a._v("]")]),a._v(" "),t("td",[a._v("指定cpu占比统计的采样间隔，单位为毫秒")])])])]),a._v(" "),t("blockquote",[t("p",[a._v("cpu占比是如何统计出来的？")])]),a._v(" "),t("blockquote",[t("p",[a._v("这里的cpu统计的是，一段采样间隔内，当前JVM里各个线程所占用的cpu时间占总cpu时间的百分比。其计算方法为： 首先进行一次采样，获得所有线程的cpu的使用时间(调用的是"),t("code",[a._v("java.lang.management.ThreadMXBean#getThreadCpuTime")]),a._v("这个接口)，然后睡眠一段时间，默认100ms，可以通过"),t("code",[a._v("-i")]),a._v("参数指定，然后再采样一次，最后得出这段时间内各个线程消耗的cpu时间情况，最后算出百分比。")])]),a._v(" "),t("blockquote",[t("p",[a._v("注意： 这个统计也会产生一定的开销（JDK这个接口本身开销比较大），因此会看到as的线程占用一定的百分比，为了降低统计自身的开销带来的影响，可以把采样间隔拉长一些，比如5000毫秒。")])]),a._v(" "),t("blockquote",[t("p",[a._v("如果想看从Java进程启动开始到现在的cpu占比情况：可以使用"),t("a",{attrs:{href:"https://github.com/oldratlee/useful-scripts/blob/master/docs/java.md#-show-busy-java-threads",target:"_blank",rel:"noopener noreferrer"}},[a._v("show-busy-java-threads"),t("OutboundLink")],1),a._v("这个脚本")])]),a._v(" "),t("h2",{attrs:{id:"使用参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用参考","aria-hidden":"true"}},[a._v("#")]),a._v(" 使用参考")]),a._v(" "),t("h3",{attrs:{id:"支持一键展示当前最忙的前n个线程并打印堆栈："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#支持一键展示当前最忙的前n个线程并打印堆栈：","aria-hidden":"true"}},[a._v("#")]),a._v(" 支持一键展示当前最忙的前N个线程并打印堆栈：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('$ thread -n 3\n"as-command-execute-daemon" Id=29 cpuUsage=75% RUNNABLE\n    at sun.management.ThreadImpl.dumpThreads0(Native Method)\n    at sun.management.ThreadImpl.getThreadInfo(ThreadImpl.java:440)\n    at com.taobao.arthas.core.command.monitor200.ThreadCommand$1.action(ThreadCommand.java:58)\n    at com.taobao.arthas.core.command.handler.AbstractCommandHandler.execute(AbstractCommandHandler.java:238)\n    at com.taobao.arthas.core.command.handler.DefaultCommandHandler.handleCommand(DefaultCommandHandler.java:67)\n    at com.taobao.arthas.core.server.ArthasServer$4.run(ArthasServer.java:276)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n \n    Number of locked synchronizers = 1\n    - java.util.concurrent.ThreadPoolExecutor$Worker@6cd0b6f8\n \n"as-session-expire-daemon" Id=25 cpuUsage=24% TIMED_WAITING\n    at java.lang.Thread.sleep(Native Method)\n    at com.taobao.arthas.core.server.DefaultSessionManager$2.run(DefaultSessionManager.java:85)\n \n"Reference Handler" Id=2 cpuUsage=0% WAITING on java.lang.ref.Reference$Lock@69ba0f27\n    at java.lang.Object.wait(Native Method)\n    -  waiting on java.lang.ref.Reference$Lock@69ba0f27\n    at java.lang.Object.wait(Object.java:503)\n    at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)\n')])])]),t("h3",{attrs:{id:"当没有参数时，显示所有线程的信息。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#当没有参数时，显示所有线程的信息。","aria-hidden":"true"}},[a._v("#")]),a._v(" 当没有参数时，显示所有线程的信息。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("$ thread\nThreads Total: 16, NEW: 0, RUNNABLE: 7, BLOCKED: 0, WAITING: 5, TIMED_WAITING: 4, TERMINATED: 0\nID         NAME                             GROUP                 PRIORITY   STATE      %CPU       TIME       INTERRUPTE DAEMON\n30         as-command-execute-daemon        system                9          RUNNABLE   72         0:0        false      true\n23         as-session-expire-daemon         system                9          TIMED_WAIT 27         0:0        false      true\n22         Attach Listener                  system                9          RUNNABLE   0          0:0        false      true\n11         pool-2-thread-1                  main                  5          TIMED_WAIT 0          0:0        false      false\n12         Thread-2                         main                  5          RUNNABLE   0          0:0        false      true\n13         pool-3-thread-1                  main                  5          TIMED_WAIT 0          0:0        false      false\n25         as-selector-daemon               system                9          RUNNABLE   0          0:0        false      true\n14         Thread-3                         main                  5          TIMED_WAIT 0          0:0        false      false\n26         pool-5-thread-1                  system                5          WAITING    0          0:0        false      false\n15         Thread-4                         main                  5          RUNNABLE   0          0:0        false      false\n1          main                             main                  5          WAITING    0          0:2        false      false\n2          Reference Handler                system                10         WAITING    0          0:0        false      true\n3          Finalizer                        system                8          WAITING    0          0:0        false      true\n4          Signal Dispatcher                system                9          RUNNABLE   0          0:0        false      true\n20         NonBlockingInputStreamThread     main                  5          WAITING    0          0:0        false      true\n21         Thread-8                         main                  5          RUNNABLE   0          0:0        false      true\n")])])]),t("h3",{attrs:{id:"thread-id，-显示指定线程的运行堆栈"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#thread-id，-显示指定线程的运行堆栈","aria-hidden":"true"}},[a._v("#")]),a._v(" thread id， 显示指定线程的运行堆栈")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('$ thread 1\n"main" Id=1 WAITING on java.util.concurrent.CountDownLatch$Sync@29fafb28\n    at sun.misc.Unsafe.park(Native Method)\n    -  waiting on java.util.concurrent.CountDownLatch$Sync@29fafb28\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:997)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304)\n    at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:231)\n')])])]),t("h3",{attrs:{id:"thread-b-找出当前阻塞其他线程的线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#thread-b-找出当前阻塞其他线程的线程","aria-hidden":"true"}},[a._v("#")]),a._v(" thread -b, 找出当前阻塞其他线程的线程")]),a._v(" "),t("p",[a._v("有时候我们发现应用卡住了， 通常是由于某个线程拿住了某个锁， 并且其他线程都在等待这把锁造成的。 为了排查这类问题， arthas提供了"),t("code",[a._v("thread -b")]),a._v("， 一键找出那个罪魁祸首。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('$ thread -b\n"http-bio-8080-exec-4" Id=27 TIMED_WAITING\n    at java.lang.Thread.sleep(Native Method)\n    at test.arthas.TestThreadBlocking.doGet(TestThreadBlocking.java:22)\n    -  locked java.lang.Object@725be470 <---- but blocks 4 other threads!\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:624)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:731)\n    at \n')])])]),t("blockquote",[t("p",[a._v("注意， 目前只支持找出synchronized关键字阻塞住的线程， 如果是"),t("code",[a._v("java.util.concurrent.Lock")]),a._v("， 目前还不支持。")])])])}),[],!1,null,null,null);e.default=n.exports}}]);