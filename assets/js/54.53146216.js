(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{452:function(t,a,e){"use strict";e.r(a);var s=e(20),r=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"centos7å®‰è£…ç»´æŠ¤gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos7å®‰è£…ç»´æŠ¤gitlab"}},[t._v("#")]),t._v(" CentOS7å®‰è£…ç»´æŠ¤Gitlab")]),t._v(" "),a("h1",{attrs:{id:"ç›®å½•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç›®å½•"}},[t._v("#")]),t._v(" ç›®å½•")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%AE%98%E6%96%B9%E5%AE%89%E8%A3%85",target:"_blank",rel:"noopener noreferrer"}},[t._v("å®˜æ–¹å®‰è£…"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("ç¬¬ä¸‰æ–¹é•œåƒå®‰è£…\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E7%BC%96%E8%BE%91%E6%BA%90",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç¼–è¾‘æº"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E6%9B%B4%E6%96%B0%E6%9C%AC%E5%9C%B0yum%E7%BC%93%E5%AD%98",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ›´æ–°æœ¬åœ°YUMç¼“å­˜"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%AE%89%E8%A3%85%E7%A4%BE%E5%8C%BA%E7%89%88",target:"_blank",rel:"noopener noreferrer"}},[t._v("å®‰è£…ç¤¾åŒºç‰ˆ"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E6%9B%B4%E6%94%B9%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ›´æ”¹é…ç½®"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E9%85%8D%E7%BD%AE%E5%B9%B6%E5%90%AF%E5%8A%A8gitlab",target:"_blank",rel:"noopener noreferrer"}},[t._v("é…ç½®å¹¶å¯åŠ¨GitLab"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E7%99%BB%E5%BD%95gitlab",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç™»å½•GitLab"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#docker%E5%AE%89%E8%A3%85",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dockerå®‰è£…"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%8D%B8%E8%BD%BD",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¸è½½"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("è¿ç»´\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86",target:"_blank",rel:"noopener noreferrer"}},[t._v("æœåŠ¡ç®¡ç†"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ—¥å¿—æŸ¥çœ‹"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E9%87%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81",target:"_blank",rel:"noopener noreferrer"}},[t._v("é‡ç½®ç®¡ç†å‘˜å¯†ç "),a("OutboundLink")],1)])])]),t._v(" "),a("li",[t._v("å¤‡ä»½æ¢å¤\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E4%BF%AE%E6%94%B9%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%E9%BB%98%E8%AE%A4%E7%9B%AE%E5%BD%95",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä¿®æ”¹å¤‡ä»½æ–‡ä»¶é»˜è®¤ç›®å½•"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%88%9B%E5%BB%BA%E5%A4%87%E4%BB%BD",target:"_blank",rel:"noopener noreferrer"}},[t._v("åˆ›å»ºå¤‡ä»½"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%BC%80%E5%A7%8B%E5%A4%87%E4%BB%BD",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¼€å§‹å¤‡ä»½"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD",target:"_blank",rel:"noopener noreferrer"}},[t._v("è‡ªåŠ¨å¤‡ä»½"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%A4%87%E4%BB%BD%E4%BF%9D%E7%95%99%E4%B8%83%E5%A4%A9",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¤‡ä»½ä¿ç•™ä¸ƒå¤©"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%BC%80%E5%A7%8B%E6%81%A2%E5%A4%8D",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¼€å§‹æ¢å¤"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿æ¥æ•°æ®åº“"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%84%E7%9B%AE%E5%BD%95",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä¸€äº›å¸¸è§„ç›®å½•"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E4%BD%BF%E7%94%A8https",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä½¿ç”¨HTTPS"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E6%9A%B4%E5%8A%9B%E5%8D%87%E7%BA%A7",target:"_blank",rel:"noopener noreferrer"}},[t._v("æš´åŠ›å‡çº§"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E4%BC%98%E5%8C%96%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä¼˜åŒ–å†…å­˜ä½¿ç”¨"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("é”™è¯¯å¤„ç†\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E8%A7%A3%E5%86%B380%E7%AB%AF%E5%8F%A3%E8%A2%AB%E5%8D%A0%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[t._v("è§£å†³80ç«¯å£è¢«å ç”¨"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%A4%B4%E5%83%8F%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E6%98%BE%E7%A4%BA",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¤´åƒæ— æ³•æ­£å¸¸æ˜¾ç¤º"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#internal-api-unreachable",target:"_blank",rel:"noopener noreferrer"}},[t._v("internal API unreachable"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#proxy_temp-%E7%9B%AE%E5%BD%95%E6%B2%A1%E6%9C%89%E6%9D%83%E9%99%90",target:"_blank",rel:"noopener noreferrer"}},[t._v("proxy_temp ç›®å½•æ²¡æœ‰æƒé™"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#webhooks-%E9%94%99%E8%AF%AF",target:"_blank",rel:"noopener noreferrer"}},[t._v("webhooks é”™è¯¯"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E6%9C%8D%E5%8A%A1%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8",target:"_blank",rel:"noopener noreferrer"}},[t._v("æœåŠ¡æ— æ³•å¯åŠ¨"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%85%B6%E5%AE%83%E9%94%99%E8%AF%AF",target:"_blank",rel:"noopener noreferrer"}},[t._v("å…¶å®ƒé”™è¯¯"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/guanhui07/blog/issues/392#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99",target:"_blank",rel:"noopener noreferrer"}},[t._v("å‚è€ƒèµ„æ–™"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"å®˜æ–¹å®‰è£…"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®˜æ–¹å®‰è£…"}},[t._v("#")]),t._v(" å®˜æ–¹å®‰è£…")]),t._v(" "),a("p",[t._v("ä¸‹é¢æ˜¯å®˜ç½‘å¤åˆ¶è¿‡æ¥çš„å®˜æ–¹å®‰è£…æ–¹æ³•ï¼Œæœ€ç®€å•çš„å®‰è£…ï¼Œåœ¨æˆ‘å¤§å¤©æœï¼Œåªèƒ½æœ›å¤©å…´å¹ï¼Œä½ å¯ç¿»å¢™å®‰è£…æˆ–è€…ç•¥è¿‡è¿™é‡Œï¼Œçœ‹ä¸‹é¢çš„ã€‚")]),t._v(" "),a("ol",[a("li",[t._v("å®‰è£…å¹¶é…ç½®å¿…è¦çš„ä¾èµ–é¡¹")])]),t._v(" "),a("p",[t._v("If you install Postfix to send email please select 'Internet Site' during setup. Instead of using Postfix you can also use Sendmail or configure a custom SMTP server and configure it as an SMTP server.")]),t._v(" "),a("p",[t._v("On Centos 6 and 7, the commands below will also open HTTP and SSH access in the system firewall.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo yum install curl openssh-server openssh-clients postfix cronie\nsudo service postfix start\nsudo chkconfig postfix on\nsudo lokkit -s http -s ssh\n")])])]),a("ol",[a("li",[t._v("æ·»åŠ gitlabæœåŠ¡å™¨åŒ…å’Œå®‰è£…åŒ…")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sS")]),t._v(" https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gitlab-ce\n")])])]),a("p",[t._v("If you are not comfortable installing the repository through a piped script, you can find the entire script here and select and download the package manually and install using\n"),a("a",{attrs:{href:"https://packages.gitlab.com/gitlab/gitlab-ce",target:"_blank",rel:"noopener noreferrer"}},[t._v("gitlab/gitlab-ce"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-LJO")]),t._v(" https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/6/gitlab-ce-XXX.rpm/download\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-LJO")]),t._v(" https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/7/gitlab-ce-10.2.2-ce.0.el7.x86_64.rpm/download\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" gitlab-ce-XXX.rpm\n")])])]),a("ol",[a("li",[t._v("é…ç½®å¹¶å¯åŠ¨GitLab")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl reconfigure\n")])])]),a("ol",[a("li",[t._v("æµè§ˆå™¨æ‰“å¼€å¹¶ç™»å½•")])]),t._v(" "),a("p",[t._v("On your first visit, you'll be redirected to a password reset screen to provide the password for the initial administrator account. Enter your desired password and you'll be redirected back to the login screen.")]),t._v(" "),a("p",[t._v("The default account's username is root. Provide the password you created earlier and login. After login you can change the username if you wish.")]),t._v(" "),a("h2",{attrs:{id:"ç¬¬ä¸‰æ–¹é•œåƒå®‰è£…"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¬¬ä¸‰æ–¹é•œåƒå®‰è£…"}},[t._v("#")]),t._v(" ç¬¬ä¸‰æ–¹é•œåƒå®‰è£…")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://mirror.tuna.tsinghua.edu.cn/help/gitlab-ce/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitlab Community Edition é•œåƒä½¿ç”¨å¸®åŠ©"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/hehongwei44/my-blog/issues/19",target:"_blank",rel:"noopener noreferrer"}},[t._v("åœ¨é˜¿é‡Œäº‘ä¸Šé€šè¿‡Omnibusä¸€é”®å®‰è£…åŒ…å®‰è£…Gitlab"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"ç¼–è¾‘æº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–è¾‘æº"}},[t._v("#")]),t._v(" ç¼–è¾‘æº")]),t._v(" "),a("p",[t._v("æ–°å»º /etc/yum.repos.d/gitlab-ce.repoï¼Œå†…å®¹ä¸º")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mirror.tuna.tsinghua.edu.cn/help/gitlab-ce/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä½¿ç”¨æ¸…åå¤§å­¦ TUNA é•œåƒæº"),a("OutboundLink")],1),t._v(" æ‰“å¼€ç½‘å€å°†å†…å®¹å¤åˆ¶åˆ°"),a("code",[t._v("gitlab-ce.repo")]),t._v("æ–‡ä»¶ä¸­ï¼Œç¼–è¾‘è·¯å¾„"),a("code",[t._v("vim /etc/yum.repos.d/gitlab-ce.repo")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gitlab-ce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("gitlab-ce\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("baseurl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("repo_gpgcheck")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgcheck")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgkey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://packages.gitlab.com/gpg.key\n")])])]),a("h3",{attrs:{id:"æ›´æ–°æœ¬åœ°yumç¼“å­˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ›´æ–°æœ¬åœ°yumç¼“å­˜"}},[t._v("#")]),t._v(" æ›´æ–°æœ¬åœ°YUMç¼“å­˜")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum makecache\n")])])]),a("h3",{attrs:{id:"å®‰è£…ç¤¾åŒºç‰ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®‰è£…ç¤¾åŒºç‰ˆ"}},[t._v("#")]),t._v(" å®‰è£…ç¤¾åŒºç‰ˆ")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gitlab-ce "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#(è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆ)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gitlab-ce-8.15.2-ce.0.el6 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#(å®‰è£…æŒ‡å®šç‰ˆæœ¬)")]),t._v("\n")])])]),a("h3",{attrs:{id:"æ›´æ”¹é…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ›´æ”¹é…ç½®"}},[t._v("#")]),t._v(" æ›´æ”¹é…ç½®")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/gitlab/gitlab.rb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ‰¾åˆ° external_url 'http://000.00.00.00:8081'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¿®æ”¹æˆä½ çš„åœ°å€")]),t._v("\n")])])]),a("h3",{attrs:{id:"é…ç½®å¹¶å¯åŠ¨gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®å¹¶å¯åŠ¨gitlab"}},[t._v("#")]),t._v(" é…ç½®å¹¶å¯åŠ¨GitLab")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ‰“å¼€`/etc/gitlab/gitlab.rb`,")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å°†`external_url = 'http://git.example.com'`ä¿®æ”¹ä¸ºè‡ªå·±çš„IPåœ°å€ï¼š`http://xxx.xx.xxx.xx`ï¼Œ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯¹GitLabè¿›è¡Œç¼–è¯‘ã€‚")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl reconfigure\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ¸…é™¤ç¼“å­˜")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-rake cache:clear "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RAILS_ENV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("production\n")])])]),a("h3",{attrs:{id:"ç™»å½•gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç™»å½•gitlab"}},[t._v("#")]),t._v(" ç™»å½•GitLab")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("Username: root \nPassword: 5iveL"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("fe\n")])])]),a("h2",{attrs:{id:"dockerå®‰è£…"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerå®‰è£…"}},[t._v("#")]),t._v(" Dockerå®‰è£…")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/jaywcjlove/docker-tutorial/blob/master/gitlab.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker å®‰è£… Gitlab æ•™ç¨‹"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"å¸è½½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¸è½½"}},[t._v("#")]),t._v(" å¸è½½")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl uninstall\n")])])]),a("h2",{attrs:{id:"è¿ç»´"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¿ç»´"}},[t._v("#")]),t._v(" è¿ç»´")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¿®æ”¹é»˜è®¤çš„é…ç½®æ–‡ä»¶")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/gitlab/gitlab.rb\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æŸ¥çœ‹ç‰ˆæœ¬")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /opt/gitlab/embedded/service/gitlab-rails/VERSION\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# echo "vm.overcommit_memory=1" >> /etc/sysctl.conf')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sysctl -p")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo never > /sys/kernel/mm/transparent_hugepage/enabled")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ£€æŸ¥gitlab")]),t._v("\ngitlab-rake gitlab:check "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SANITIZE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--trace")]),t._v("\ngitlab-rake gitlab:check\ngitlab-rake gitlab:check "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SANITIZE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æŸ¥çœ‹æ—¥å¿—")]),t._v("\ngitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ•°æ®åº“å…³ç³»å‡çº§")]),t._v("\ngitlab-rake db:migrate\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ¸…ç†ç¼“å­˜")]),t._v("\ngitlab-rake cache:clear\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ›´æ–°gitlabåŒ…")]),t._v("\nyum update gitlab-ce\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å‡çº§gitlab")]),t._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gitlab-ce\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å‡çº§æ•°æ®å‘½ä»¤")]),t._v("\ngitlab-ctl pg-upgrade\n")])])]),a("h3",{attrs:{id:"æœåŠ¡ç®¡ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æœåŠ¡ç®¡ç†"}},[t._v("#")]),t._v(" æœåŠ¡ç®¡ç†")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("gitlab-ctl start # å¯åŠ¨æ‰€æœ‰ gitlab ç»„ä»¶ï¼š\ngitlab-ctl stop  # åœæ­¢æ‰€æœ‰ gitlab ç»„ä»¶ï¼š\ngitlab-ctl stop postgresql # åœæ­¢æ‰€æœ‰ gitlab postgresql ç»„ä»¶ï¼š\n# åœæ­¢ç›¸å…³æ•°æ®è¿æ¥æœåŠ¡\ngitlab-ctl stop unicorn\ngitlab-ctl stop sidekiq\ngitlab-ctl restart # é‡å¯æ‰€æœ‰ gitlab ç»„ä»¶ï¼š\ngitlab-ctl restart gitlab-workhorse # é‡å¯æ‰€æœ‰ gitlab gitlab-workhorse ç»„ä»¶ï¼š\ngitlab-ctl status # æŸ¥çœ‹æœåŠ¡çŠ¶æ€\ngitlab-ctl reconfigure # ç”Ÿæˆé…ç½®å¯åŠ¨æœåŠ¡\n")])])]),a("h3",{attrs:{id:"æ—¥å¿—æŸ¥çœ‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ—¥å¿—æŸ¥çœ‹"}},[t._v("#")]),t._v(" æ—¥å¿—æŸ¥çœ‹")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æŸ¥çœ‹æ—¥å¿—")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" redis "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ£€æŸ¥redisçš„æ—¥å¿—")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" postgresql       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ£€æŸ¥postgresqlçš„æ—¥å¿—")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" gitlab-workhorse "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ£€æŸ¥gitlab-workhorseçš„æ—¥å¿—")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("logrotate")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ£€æŸ¥logrotateçš„æ—¥å¿—")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" nginx    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ£€æŸ¥nginxçš„æ—¥å¿—")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" sidekiq  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ£€æŸ¥sidekiqçš„æ—¥å¿—")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" unicorn  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ£€æŸ¥unicornçš„æ—¥å¿—")]),t._v("\n")])])]),a("h3",{attrs:{id:"æ±‰åŒ–gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ±‰åŒ–gitlab"}},[t._v("#")]),t._v(" æ±‰åŒ–gitlab")]),t._v(" "),a("ul",[a("li",[t._v("1.å…‹éš†æ±‰åŒ–è¡¥ä¸ä»“åº“")])]),t._v(" "),a("div",{staticClass:"language-sehll extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("git clone https://gitlab.com/xhang/gitlab.git\n")])])]),a("ul",[a("li",[t._v("2.æŸ¥çœ‹å½“å‰gitlabç‰ˆæœ¬å¹¶ä¸”è·å–å¯¹åº”ç‰ˆæœ¬çš„ä¸­æ–‡è¡¥ä¸")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-1")]),t._v(" /opt/gitlab/version-manifest.txt\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å½“ç„¶ï¼Œæˆ‘ä»¬å®‰è£…çš„æ˜¯gitlab-ce 10.8.4ç‰ˆ")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" gitlab\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("diff")]),t._v(" v10.8.4 v10.8.4-zh  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/v10.8.4-zh.diff\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#è¿›å…¥åˆšæ‰cloneä¸‹æ¥çš„gitlabç›®å½•")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ç”¨diffå°†è‹±æ–‡åŸç‰ˆä¸ä¸­æ–‡ç‰ˆçš„å¯¹æ¯”ç”Ÿæˆ.diffæ–‡ä»¶")]),t._v("\n")])])]),a("ul",[a("li",[t._v("3.å°†ä¸­æ–‡è¡¥ä¸å¯¼å…¥gitlab")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("gitlab-ctl stop\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#åœæ­¢gitlab")]),t._v("\n\npatch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" /opt/gitlab/embedded/service/gitlab-rails "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/v10.8.4-zh.diff\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å°†åˆšæ‰çš„diffæ–‡ä»¶åšä¸ºè¡¥ä¸å¯¼å…¥åˆ°gitlabä¸­")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#patchå¯èƒ½éœ€è¦è‡ªè¡Œå®‰è£…:yum install -y patch")]),t._v("\n\ngitlab-ctl start\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#å¯åŠ¨gitlabå°±èƒ½çœ‹åˆ°ç†Ÿæ‚‰çš„ä¸­æ–‡å•¦ï¼")]),t._v("\n")])])]),a("h3",{attrs:{id:"é‡ç½®ç®¡ç†å‘˜å¯†ç "}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é‡ç½®ç®¡ç†å‘˜å¯†ç "}},[t._v("#")]),t._v(" é‡ç½®ç®¡ç†å‘˜å¯†ç ")]),t._v(" "),a("p",[t._v("Gitlabç®¡ç†å‘˜å¯†ç å¿˜è®°ï¼Œæ€ä¹ˆé‡ç½®å¯†ç ï¼ŒGitlab ä¿®æ”¹rootç”¨æˆ·å¯†ç ï¼Œ"),a("a",{attrs:{href:"http://docs.gitlab.com/ce/security/reset_root_password.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("How to reset your root password"),a("OutboundLink")],1),t._v("ã€‚")]),t._v(" "),a("p",[t._v("ä½¿ç”¨railså·¥å…·æ‰“å¼€ç»ˆç«¯")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo gitlab-rails console production\n")])])]),a("p",[t._v("æŸ¥è¯¢ç”¨æˆ·çš„emailï¼Œç”¨æˆ·åï¼Œå¯†ç ç­‰ä¿¡æ¯ï¼Œid:1 è¡¨ç¤ºrootè´¦å·")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("user = User.where(id: 1).first\n")])])]),a("p",[t._v("é‡æ–°è®¾ç½®å¯†ç ")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("user.password = 'æ–°å¯†ç '\nuser.password_confirmation = 'æ–°å¯†ç 'ã€€\n")])])]),a("p",[t._v("ä¿å­˜å¯†ç ")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("user.save!\n")])])]),a("p",[t._v("å®Œæ•´çš„æ“ä½œrubyè„šæœ¬")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("user = User.where(id: 1).first\nuser.password = 'æ–°å¯†ç '\nuser.password_confirmation = 'æ–°å¯†ç '\nuser.save!\n")])])]),a("h2",{attrs:{id:"å¤‡ä»½æ¢å¤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¤‡ä»½æ¢å¤"}},[t._v("#")]),t._v(" å¤‡ä»½æ¢å¤")]),t._v(" "),a("p",[t._v("ä½¿ç”¨Gitlabä¸€é”®å®‰è£…åŒ…å®‰è£…Gitlabéå¸¸ç®€å•, åŒæ ·çš„å¤‡ä»½æ¢å¤ä¸è¿ç§»ä¹Ÿéå¸¸ç®€å•,ç”¨ä¸€æ¡å‘½ä»¤å³å¯åˆ›å»ºå®Œæ•´çš„Gitlabå¤‡ä»½:")]),t._v(" "),a("h3",{attrs:{id:"ä¿®æ”¹å¤‡ä»½æ–‡ä»¶é»˜è®¤ç›®å½•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¿®æ”¹å¤‡ä»½æ–‡ä»¶é»˜è®¤ç›®å½•"}},[t._v("#")]),t._v(" ä¿®æ”¹å¤‡ä»½æ–‡ä»¶é»˜è®¤ç›®å½•")]),t._v(" "),a("p",[t._v("ä¿®æ”¹"),a("code",[t._v("/etc/gitlab/gitlab.rb")]),t._v("æ¥ä¿®æ”¹é»˜è®¤å­˜æ”¾å¤‡ä»½æ–‡ä»¶çš„ç›®å½•:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("gitlab_rails['backup_path'] = '/mnt/backups'  \n")])])]),a("h3",{attrs:{id:"åˆ›å»ºå¤‡ä»½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºå¤‡ä»½"}},[t._v("#")]),t._v(" åˆ›å»ºå¤‡ä»½")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("gitlab-rake gitlab:backup:create\n")])])]),a("p",[t._v("ä»¥ä¸Šå‘½ä»¤å°†åœ¨ "),a("code",[t._v("/var/opt/gitlab/backups")]),t._v(" ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåç§°ç±»ä¼¼ä¸ºxxxxxxxx_gitlab_backup.tarçš„å‹ç¼©åŒ…, è¿™ä¸ªå‹ç¼©åŒ…å°±æ˜¯Gitlabæ•´ä¸ªçš„å®Œæ•´éƒ¨åˆ†, å…¶ä¸­å¼€å¤´çš„xxxxxxæ˜¯å¤‡ä»½åˆ›å»ºçš„æ—¶é—´æˆ³ã€‚")]),t._v(" "),a("p",[t._v("ä¿®æ”¹åä½¿ç”¨gitlab-ctl reconfigureå‘½ä»¤é‡è½½é…ç½®æ–‡ä»¶ã€‚")]),t._v(" "),a("h3",{attrs:{id:"å¼€å§‹å¤‡ä»½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¼€å§‹å¤‡ä»½"}},[t._v("#")]),t._v(" å¼€å§‹å¤‡ä»½")]),t._v(" "),a("p",[t._v("è¿™é‡Œæ”¾ä½ çš„å¤‡ä»½æ–‡ä»¶æ–‡ä»¶å¤¹ï¼Œå’Œä»“åº“æºæ–‡ä»¶ã€‚")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/var/opt/gitlab/backups                   # å¤‡ä»½æ–‡ä»¶æ–‡ä»¶å¤¹\n/var/opt/gitlab/git-data/repositories     # gitä»“åº“æºæ–‡ä»¶\n")])])]),a("h3",{attrs:{id:"è‡ªåŠ¨å¤‡ä»½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è‡ªåŠ¨å¤‡ä»½"}},[t._v("#")]),t._v(" è‡ªåŠ¨å¤‡ä»½")]),t._v(" "),a("p",[t._v("é€šè¿‡crontabä½¿ç”¨å¤‡ä»½å‘½ä»¤å®ç°è‡ªåŠ¨å¤‡ä»½")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("crontab -e\n# æ¯å¤©2ç‚¹å¤‡ä»½gitlabæ•°æ®\n0 2 * * * /usr/bin/gitlab-rake gitlab:backup:create\n0 2 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create\n")])])]),a("p",[t._v("ä¸Šé¢ä¸¤è¡Œä¿å­˜ä¹‹åï¼Œé‡æ–°è½½å…¥é…ç½®")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("service crond reload\n# or\nsystemctl reload crond.service\n")])])]),a("h3",{attrs:{id:"å¤‡ä»½ä¿ç•™ä¸ƒå¤©"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¤‡ä»½ä¿ç•™ä¸ƒå¤©"}},[t._v("#")]),t._v(" å¤‡ä»½ä¿ç•™ä¸ƒå¤©")]),t._v(" "),a("p",[t._v("è®¾ç½®åªä¿å­˜æœ€è¿‘7å¤©çš„å¤‡ä»½ï¼Œç¼–è¾‘ /etc/gitlab/gitlab.rb é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°å¦‚ä¸‹ä»£ç ï¼Œåˆ é™¤æ³¨é‡Š "),a("code",[t._v("#")]),t._v(" ä¿å­˜")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# /etc/gitlab/gitlab.rb é…ç½®æ–‡ä»¶ ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œ\ngitlab_rails['backup_keep_time'] = 604800  \n")])])]),a("p",[t._v("é‡æ–°åŠ è½½gitlabé…ç½®æ–‡ä»¶")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo gitlab-ctl reconfigure  \n")])])]),a("h3",{attrs:{id:"å¼€å§‹æ¢å¤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¼€å§‹æ¢å¤"}},[t._v("#")]),t._v(" å¼€å§‹æ¢å¤")]),t._v(" "),a("p",[t._v("è¿ç§»å¦‚åŒå¤‡ä»½ä¸æ¢å¤çš„æ­¥éª¤ä¸€æ ·, åªéœ€è¦å°†è€æœåŠ¡å™¨ "),a("code",[t._v("/var/opt/gitlab/backups")]),t._v(" ç›®å½•ä¸‹çš„å¤‡ä»½æ–‡ä»¶æ‹·è´åˆ°æ–°æœåŠ¡å™¨ä¸Šçš„ "),a("code",[t._v("/var/opt/gitlab/backups")]),t._v(" å³å¯(å¦‚æœä½ æ²¡ä¿®æ”¹è¿‡é»˜è®¤å¤‡ä»½ç›®å½•çš„è¯)ã€‚ ç„¶åæ‰§è¡Œæ¢å¤å‘½ä»¤ã€‚\nå¦‚æœä¿®æ”¹äº†ï¼Œé¦–å…ˆè¿›å…¥å¤‡ä»½ gitlab çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„ "),a("code",[t._v("gitlab_rails['backup_path']")]),t._v(" ï¼Œé»˜è®¤ä¸º "),a("code",[t._v("/var/opt/gitlab/backups")]),t._v(" ã€‚")]),t._v(" "),a("p",[t._v("ç„¶ååœæ­¢ unicorn å’Œ sidekiq ï¼Œä¿è¯æ•°æ®åº“æ²¡æœ‰æ–°çš„è¿æ¥ï¼Œä¸ä¼šæœ‰å†™æ•°æ®æƒ…å†µã€‚")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# åœæ­¢ç›¸å…³æ•°æ®è¿æ¥æœåŠ¡\ngitlab-ctl stop unicorn\n# ok: down: unicorn: 0s, normally up\ngitlab-ctl stop sidekiq\n# ok: down: sidekiq: 0s, normally up\n\n# ä»xxxxxç¼–å·å¤‡ä»½ä¸­æ¢å¤\n# ç„¶åæ¢å¤æ•°æ®ï¼Œ1406691018ä¸ºå¤‡ä»½æ–‡ä»¶çš„æ—¶é—´æˆ³\ngitlab-rake gitlab:backup:restore BACKUP=1406691018\n\n# æ–°ç‰ˆæœ¬ 1483533591_2017_01_04_gitlab_backup.tar\ngitlab-rake gitlab:backup:restore BACKUP=1483533591_2017_01_04_gitlab_backup.tar\n\n# å¯åŠ¨Gitlab\nsudo gitlab-ctl start  \n")])])]),a("p",[t._v("åˆ¤æ–­æ˜¯æ‰§è¡Œå®é™…æ“ä½œçš„gitlabç›¸å…³ç”¨æˆ·ï¼šgitï¼Œæ²¡æœ‰å¾—åˆ°è¶³å¤Ÿçš„æƒé™ã€‚ä¾æ¬¡æ‰§è¡Œå‘½ä»¤ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# æ¢å¤è¿‡ç¨‹ä¸­æ²¡æœ‰æƒé™\nmkdir /var/opt/gitlab/backups\nchown git /var/opt/gitlab/backups\nchmod 700 /var/opt/gitlab/backups\n\n# æ¢å¤æˆåŠŸé¡µé¢æŠ¥æ²¡æœ‰æƒé™çš„é”™è¯¯\nsudo chown -R git:git /var/opt/gitlab/git-data/repositories\nsudo chmod -R ug+rwX,o-rwx /var/opt/gitlab/git-data/repositories\nsudo chmod -R ug-s /var/opt/gitlab/git-data/repositories\nsudo find /var/opt/gitlab/git-data/repositories -type d -print0 | sudo xargs -0 chmod g+s\n")])])]),a("p",[t._v("å¦‚æœå¤‡ä»½æ–‡ä»¶æŠ¥æ²¡æœ‰æƒé™ï¼Œé€šè¿‡"),a("code",[t._v("ls -al")]),t._v("æŸ¥çœ‹æƒé™æ˜¯ä¸æ˜¯"),a("code",[t._v("git")]),t._v("ï¼Œè€Œä¸æ˜¯"),a("code",[t._v("root")]),t._v("ï¼Œé€šè¿‡ä¸‹é¢æ–¹å¼ç»™"),a("code",[t._v("git")]),t._v("ç”¨æˆ·æƒé™")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo chown -R git:git 1483533591_2017_01_04_gitlab_backup.tar\n")])])]),a("h2",{attrs:{id:"è¿æ¥æ•°æ®åº“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¿æ¥æ•°æ®åº“"}},[t._v("#")]),t._v(" è¿æ¥æ•°æ®åº“")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# ç™»é™†gitlabçš„å®‰è£…æœåŠ¡æŸ¥çœ‹é…ç½®æ–‡ä»¶\ncat /var/opt/gitlab/gitlab-rails/etc/database.yml \n\nvim /var/opt/gitlab/postgresql/data/postgresql.conf\n# listen_addresses = '192.168.1.125' # ä¿®æ”¹ç›‘å¬åœ°å€ä¸ºip\n# æˆ–è€…æ”¹ä¸º \"*\"\n")])])]),a("p",[t._v("ä¿®æ”¹ "),a("code",[t._v("pg_hba.conf")]),t._v(" é…ç½®")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vim  /var/opt/gitlab/postgresql/data/pg_hba.conf\n# å°†ä¸‹é¢è¿™ä¸€è¡Œæ·»åŠ åˆ°é…ç½®çš„æœ€åé¢\n# host    all    all    0.0.0.0/0    trust\n")])])]),a("p",[t._v("å¦‚æœä¸å¸Œæœ›å…è®¸æ‰€æœ‰IPè¿œç¨‹è®¿é—®ï¼Œåˆ™å¯ä»¥å°†ä¸Šè¿°é…ç½®é¡¹ä¸­çš„0.0.0.0è®¾å®šä¸ºç‰¹å®šçš„IPå€¼ã€‚")]),t._v(" "),a("p",[t._v("é‡å¯ "),a("code",[t._v("postgresql")]),t._v(" æ•°æ®åº“")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("gitlab-ctl restart postgresql\n")])])]),a("p",[t._v("æŸ¥çœ‹ "),a("code",[t._v("/etc/passwd")]),t._v(" æ–‡ä»¶é‡Œè¾¹ "),a("code",[t._v("gitlab")]),t._v(" å¯¹åº”çš„ç³»ç»Ÿç”¨æˆ·")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@localhost ~]$ cat /etc/passwd\n...\ngitlab-psql:x:493:490::/var/opt/gitlab/postgresql:/bin/sh  # gitlabçš„postgresqlç”¨æˆ·\n")])])]),a("h2",{attrs:{id:"ä¸€äº›å¸¸è§„ç›®å½•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€äº›å¸¸è§„ç›®å½•"}},[t._v("#")]),t._v(" ä¸€äº›å¸¸è§„ç›®å½•")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# é…ç½®ç›®å½•\n/etc/gitlab/gitlab.rb\n# ç”Ÿæˆå¥½çš„nginxé…ç½®\n/var/opt/gitlab/nginx/conf/gitlab-http.conf\n# å¤‡ä»½ç›®å½•\n/var/opt/gitlab/backups\n")])])]),a("h2",{attrs:{id:"ä½¿ç”¨https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨https"}},[t._v("#")]),t._v(" ä½¿ç”¨HTTPS")]),t._v(" "),a("p",[t._v("ç›´æ¥å°†nginxé…ç½®å¤åˆ¶åˆ°ä½ è‡ªå·±çš„nginxé…ç½®ä¸­ï¼Œåœæ‰gitlabçš„nginx")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cp /var/opt/gitlab/nginx/conf/gitlab-http.conf /usr/local/nginx/conf/vhost/\n")])])]),a("p",[t._v("å°†ä½ çš„SSLè¯ä¹¦é…ç½®å¤åˆ¶è¿›å»")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server {\n  listen 443 ssl;\n  server_name  g.doman.cn;\n  ssl_certificate /etc/letsencrypt/live/*****/certificate.crt;\n  ssl_certificate_key /etc/letsencrypt/live/*****/private.key;\n  # .....\n}\n")])])]),a("p",[t._v("ç¼–è¾‘"),a("code",[t._v("vi /usr/local/nginx/conf/nginx.conf")]),t._v("ä½ çš„nginxé…ç½®ï¼Œå¼•ç”¨ä½ å¤åˆ¶è¿‡æ¥çš„é…ç½®ã€‚")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("http {\n  # .....\n  include vhost/gitlab-http.conf;\n}\n")])])]),a("p",[t._v("åŒæ—¶è¦æŠŠ"),a("code",[t._v("/var/opt/gitlab/nginx/conf/nginx.conf")]),t._v("ä¸­çš„ä¸€äº›å˜é‡å¤åˆ¶åˆ°è‡ªå·±çš„nginxé…ç½®ä¸­"),a("code",[t._v("nginx.conf")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('http {\n  # .....\n  log_format gitlab_access \'$remote_addr - $remote_user [$time_local] "$request_method $filtered_request_uri $server_protocol" $status $body_bytes_sent "$filtered_http_referer" "$http_user_agent"\';\n  log_format gitlab_mattermost_access \'$remote_addr - $remote_user [$time_local] "$request_method $filtered_request_uri $server_protocol" $status $body_bytes_sent "$filtered_http_referer" "$http_user_agent"\';\n\n  proxy_cache_path proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2;\n  proxy_cache gitlab;\n  map $http_upgrade $connection_upgrade {\n      default upgrade;\n      \'\'      close;\n  }\n\n  # Remove private_token from the request URI\n  # In:  /foo?private_token=unfiltered&authenticity_token=unfiltered&rss_token=unfiltered&...\n  # Out: /foo?private_token=[FILTERED]&authenticity_token=unfiltered&rss_token=unfiltered&...\n  map $request_uri $temp_request_uri_1 {\n    default $request_uri;\n    ~(?i)^(?<start>.*)(?<temp>[\\?&]private[\\-_]token)=[^&]*(?<rest>.*)$ "$start$temp=[FILTERED]$rest";\n  }\n  # Remove authenticity_token from the request URI\n  # In:  /foo?private_token=[FILTERED]&authenticity_token=unfiltered&rss_token=unfiltered&...\n  # Out: /foo?private_token=[FILTERED]&authenticity_token=[FILTERED]&rss_token=unfiltered&...\n  map $temp_request_uri_1 $temp_request_uri_2 {\n    default $temp_request_uri_1;\n    ~(?i)^(?<start>.*)(?<temp>[\\?&]authenticity[\\-_]token)=[^&]*(?<rest>.*)$ "$start$temp=[FILTERED]$rest";\n  }\n  # Remove rss_token from the request URI\n  # In:  /foo?private_token=[FILTERED]&authenticity_token=[FILTERED]&rss_token=unfiltered&...\n  # Out: /foo?private_token=[FILTERED]&authenticity_token=[FILTERED]&rss_token=[FILTERED]&...\n  map $temp_request_uri_2 $filtered_request_uri {\n    default $temp_request_uri_2;\n    ~(?i)^(?<start>.*)(?<temp>[\\?&]rss[\\-_]token)=[^&]*(?<rest>.*)$ "$start$temp=[FILTERED]$rest";\n  }\n  # A version of the referer without the query string\n  map $http_referer $filtered_http_referer {\n    default $http_referer;\n    ~^(?<temp>.*)\\? $temp;\n  }\n}\n')])])]),a("h2",{attrs:{id:"æš´åŠ›å‡çº§"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æš´åŠ›å‡çº§"}},[t._v("#")]),t._v(" æš´åŠ›å‡çº§")]),t._v(" "),a("p",[t._v("æš´åŠ›å‡çº§å‰å…ˆå¤‡ä»½ï¼Œç„¶ååœæ­¢æ‰€æœ‰æœåŠ¡è¿è¡Œï¼Œè®°å¾—å¤‡ä»½çš„è‰¯å¥½ä¹ æƒ¯")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("gitlab-ctl stop  # åœæ­¢æ‰€æœ‰ gitlab ç»„ä»¶ï¼š\n# æ›´æ–°gitlabåŒ…\nyum update gitlab-ce\n")])])]),a("p",[t._v("ç›´æ¥ç¼–è¾‘æº /etc/yum.repos.d/gitlab-ce.repoï¼Œå®‰è£… GitLab ç¤¾åŒºç‰ˆ")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum list gitlab-ce # æŸ¥çœ‹ç‰ˆæœ¬\nsudo yum install gitlab-ce #(è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆ)\nsudo yum install gitlab-ce-8.15.2-ce.0.el6 #(å®‰è£…æŒ‡å®šç‰ˆæœ¬)\n")])])]),a("p",[t._v("æ³¨æ„ï¼š"),a("code",[t._v("10.7")]),t._v(" ç‰ˆæœ¬å‡çº§åˆ° "),a("code",[t._v("11.x")]),t._v(" ç‰ˆæœ¬éœ€è¦å…ˆå‡çº§åˆ° "),a("code",[t._v("10.8")]),t._v(" ç‰ˆæœ¬")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# å®‰è£…æŒ‡å®šç‰ˆæœ¬ 10.8 çš„ç‰ˆæœ¬\nsudo yum install gitlab-ce-10.8.0-ce.0.el6\n")])])]),a("p",[t._v("å®‰è£…å®Œæˆè®°å¾—å°†æ‰€æœ‰æœåŠ¡å¯èµ·æ¥å“¦")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("gitlab-ctl start # å¯åŠ¨æ‰€æœ‰æ•°æ®åº“\n# postgresql æ•°æ®åº“å¦‚æœå¯åŠ¨ä¸äº†ï¼Œé€šè¿‡é‡å¯å¯åŠ¨\ngitlab-ctl restart postgresql\n")])])]),a("p",[t._v("å®‰è£…è¿‡å¦‚æœæŠ¥é”™ï¼ŒæŸ¥çœ‹æç¤ºæ ¹æ®æç¤ºæ“ä½œï¼Œç‰ˆæœ¬è·¨åº¦å¤ªå¤§ä¼šæŠ¥é”™å“¦ã€‚")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('gitlab preinstall: Automatically backing up only the GitLab SQL database (excluding everything else!)\nDumping database ...\nDumping PostgreSQL database gitlabhq_production ... pg_dump: [archiver (db)] connection to database "gitlabhq_production" failed: could not connect to server: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•\n    Is the server running locally and accepting\n    connections on Unix domain socket "/var/opt/gitlab/postgresql/.s.PGSQL.5432"?\nBackup failed\n[FAILED]\ngitlab preinstall:\ngitlab preinstall: Backup failed! If you want to skip this backup, run the following command and\ngitlab preinstall: try again:\ngitlab preinstall:\ngitlab preinstall:   sudo touch /etc/gitlab/skip-auto-migrations\ngitlab preinstall:\nerror: %pre(gitlab-ce-8.15.2-ce.0.el6.x86_64) scriptlet failed, exit status 1\nError in PREIN scriptlet in rpm package gitlab-ce-8.15.2-ce.0.el6.x86_64\nerror:   install: %pre scriptlet failed (2), skipping gitlab-ce-8.15.2-ce.0.el6\ngitlab-ce-8.11.5-ce.0.el6.x86_64 was supposed to be removed but is not!\n  Verifying  : gitlab-ce-8.11.5-ce.0.el6.x86_64                                                                                                                                                             1/2\n  Verifying  : gitlab-ce-8.15.2-ce.0.el6.x86_64                                                                                                                                                             2/2\n\nFailed:\n  gitlab-ce.x86_64 0:8.11.5-ce.0.el6\n')])])]),a("p",[t._v("çœ‹ä¸Šé¢ä¸€å †é”™è¯¯ï¼Œç¬é—´å°±æ‡µé€¼äº†ï¼Œçœ‹åˆ°ä¸€æ¡æ•‘æ˜Ÿå‘½ä»¤è®©æˆ‘å°è¯•è¿è¡Œ "),a("code",[t._v("sudo touch /etc/gitlab/skip-auto-migrations")]),t._v(" äºæ˜¯æˆ‘äºŒé€¼çš„é‡æ–°"),a("code",[t._v("yum install gitlab-ce")]),t._v("è¿è¡Œäº†ï¼Œç»“æœçœŸçš„å®‰è£…æˆåŠŸäº†ï¼ŒğŸ˜„ã€‚")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# é‡æ–°å®‰è£…å‘½ä»¤\nyum reinstall gitlab-ce\n# or\nyum install gitlab-ce\n...\ngitlab: Thank you for installing GitLab!\ngitlab: To configure and start GitLab, RUN THE FOLLOWING COMMAND:\n\nsudo gitlab-ctl reconfigure\n\ngitlab: GitLab should be reachable at http://114.55.148.71:8081\ngitlab: Otherwise configure GitLab for your system by editing /etc/gitlab/gitlab.rb file\ngitlab: And running reconfigure again.\ngitlab:\ngitlab: For a comprehensive list of configuration options please see the Omnibus GitLab readme\ngitlab: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md\ngitlab:\n\ngitlab: GitLab now ships with a newer version of PostgreSQL (9.6.1), and will be used\ngitlab: as the default in the next major relase. To upgrade, RUN THE FOLLOWING COMMANDS:\n\nsudo gitlab-ctl pg-upgrade\n\ngitlab: For more details, please see:\ngitlab: https://docs.gitlab.com/omnibus/settings/database.html#upgrade-packaged-postgresql-server\ngitlab:\n  æ¸…ç†       : gitlab-ce-8.11.5-ce.0.el6.x86_64                                                                                                                                                             2/2\nFound /etc/gitlab/skip-auto-migrations, exiting...\n  Verifying  : gitlab-ce-8.15.2-ce.0.el6.x86_64                                                                                                                                                             1/2\n  Verifying  : gitlab-ce-8.11.5-ce.0.el6.x86_64                                                                                                                                                             2/2\n\næ›´æ–°å®Œæ¯•:\n  gitlab-ce.x86_64 0:8.15.2-ce.0.el6\n\nå®Œæ¯•ï¼\n")])])]),a("p",[t._v("é‡å¯é…ç½®ï¼Œå¯ä»¥è§£å†³å¤§éƒ¨åˆ†"),a("code",[t._v("502")]),t._v("é”™è¯¯ã€‚")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("gitlab-ctl reconfigure\n")])])]),a("h2",{attrs:{id:"ä¼˜åŒ–å†…å­˜ä½¿ç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜åŒ–å†…å­˜ä½¿ç”¨"}},[t._v("#")]),t._v(" ä¼˜åŒ–å†…å­˜ä½¿ç”¨")]),t._v(" "),a("p",[t._v("ä¿®æ”¹é…ç½®æ–‡ä»¶ "),a("code",[t._v("/etc/gitlab/gitlab.rb")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# å‡å°‘ postgresql æ•°æ®åº“ç¼“å­˜\npostgresql['shared_buffers'] = \"256MB\"\n# å‡å°‘sidekiqçš„å¹¶å‘æ•°\nsidekiq['concurrency'] = 1\n\n# workerè¿›ç¨‹æ•°\npostgresql['max_worker_processes'] = 4\n\nunicorn['worker_processes'] = 2  ## workerè¿›ç¨‹æ•°\nunicorn['worker_memory_limit_min'] = \"400 * 1 << 20\" ##workeræœ€å°å†…å­˜\nunicorn['worker_memory_limit_max'] = \"650 * 1 << 20\" ##workeræœ€å¤§å†…å­˜\n")])])]),a("h2",{attrs:{id:"é”™è¯¯å¤„ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é”™è¯¯å¤„ç†"}},[t._v("#")]),t._v(" é”™è¯¯å¤„ç†")]),t._v(" "),a("h3",{attrs:{id:"è§£å†³80ç«¯å£è¢«å ç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è§£å†³80ç«¯å£è¢«å ç”¨"}},[t._v("#")]),t._v(" è§£å†³80ç«¯å£è¢«å ç”¨")]),t._v(" "),a("p",[t._v("nginxé…ç½®è§£å†³ "),a("code",[t._v("80")]),t._v(" ç«¯å£è¢«å ç”¨")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("upstream gitlab {\n     server 114.55.111.111:8081 ;\n}\nserver {\n  # ä¾¦å¬çš„80ç«¯å£\n  listen       80;\n  server_name  git.diggg.cn;\n  location / {\n    proxy_pass   http://gitlab;    #åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªä»£ç†ï¼Œå’Œupstreamçš„åå­—ä¸€æ ·\n    #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤\n    proxy_redirect             off;\n    #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP\n    proxy_set_header           Host $host;\n    proxy_set_header           X-Real-IP $remote_addr;\n    proxy_set_header           X-Forwarded-For $proxy_add_x_forwarded_for;\n    client_max_body_size       10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°\n    client_body_buffer_size    128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°\n    proxy_connect_timeout      300; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)\n    proxy_send_timeout         300; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)\n    proxy_read_timeout         300; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)\n    proxy_buffer_size          4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°\n    proxy_buffers              4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®\n    proxy_busy_buffers_size    64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰\n    proxy_temp_file_write_size 64k; #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ \n  }\n}\n")])])]),a("p",[t._v("nginxé…ç½®æ£€æŸ¥å’Œç«‹å³ç”Ÿæ•ˆ")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# æ£€æŸ¥é…ç½®\n/usr/local/nginx/sbin/nginx -tc conf/nginx.conf\n# nginx é‡æ–°åŠ è½½é…ç½®\n/usr/local/nginx/sbin/nginx -s reload\n")])])]),a("h3",{attrs:{id:"å¤´åƒæ— æ³•æ­£å¸¸æ˜¾ç¤º"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¤´åƒæ— æ³•æ­£å¸¸æ˜¾ç¤º"}},[t._v("#")]),t._v(" å¤´åƒæ— æ³•æ­£å¸¸æ˜¾ç¤º")]),t._v(" "),a("p",[t._v("åŸå› ï¼šgravatarè¢«å¢™\nè§£å†³åŠæ³•ï¼š\nç¼–è¾‘ /etc/gitlab/gitlab.rbï¼Œå°†")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# gitlab_rails['gravatar_plain_url'] = 'http://gravatar.duoshuo.com/avatar/%{hash}?s=%{size}&d=identicon'\n")])])]),a("p",[t._v("ä¿®æ”¹ä¸ºï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("gitlab_rails['gravatar_plain_url'] = 'http://gravatar.duoshuo.com/avatar/%{hash}?s=%{size}&d=identicon'\n")])])]),a("p",[t._v("ç„¶ååœ¨å‘½ä»¤è¡Œæ‰§è¡Œï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo gitlab-ctl reconfigure \nsudo gitlab-rake cache:clear RAILS_ENV=production\n")])])]),a("h3",{attrs:{id:"internal-api-unreachable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#internal-api-unreachable"}},[t._v("#")]),t._v(" internal API unreachable")]),t._v(" "),a("p",[t._v("è¿™ä¸ªé”™è¯¯æ˜¯ä¸€ä¸ªè‡ªå·±åˆ¶é€ çš„å‘ï¼Œæˆ‘å…‹éš†å’Œæäº¤éƒ½æ²¡æœ‰åŠæ³•æï¼Œä½†æ˜¯ç½‘ç«™èƒ½æ­£å¸¸è¿è¡Œï¼Œå°è¯•äº†éå¸¸å¤šçš„æ–¹æ³•ï¼Œæœ€ç»ˆæˆ‘çš„é—®é¢˜æ˜¯"),a("code",[t._v("22")]),t._v("ç«¯å£æ²¡æœ‰éšå°„å‡ºå»ï¼Œå¥½å°´å°¬ã€‚")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("GitLab: Failed to authorize your Git request: internal API unreachable\n")])])]),a("p",[t._v("è§£å†³åŠæ³•ï¼š"),a("a",{attrs:{href:"https://gitlab.com/gitlab-org/gitlab-ce/issues/33702",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://gitlab.com/gitlab-org/gitlab-ce/issues/33702"),a("OutboundLink")],1),t._v("\né€šè¿‡é˜²ç«å¢™è§„åˆ™ 127.0.0.1")]),t._v(" "),a("h3",{attrs:{id:"proxy-temp-ç›®å½•æ²¡æœ‰æƒé™"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proxy-temp-ç›®å½•æ²¡æœ‰æƒé™"}},[t._v("#")]),t._v(" proxy_temp ç›®å½•æ²¡æœ‰æƒé™")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('[crit] 14788#0: *215 open() "/usr/local/nginx/proxy_temp/5/01/0000000015" failed (13: Permission denied) while reading upstream\n')])])]),a("p",[t._v("ä»¥ä¸‹æ–¹å¼è§£å†³")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("chown -R root:root /usr/local/nginx/proxy_temp\n# ç¼–è¾‘ nginx.conf\nsudo vi /usr/local/nginx/conf/nginx.conf\n# åœ¨ç¬¬ä¸€è¡Œæ·»åŠ \nuser root;\n")])])]),a("h3",{attrs:{id:"webhooks-é”™è¯¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webhooks-é”™è¯¯"}},[t._v("#")]),t._v(" webhooks é”™è¯¯")]),t._v(" "),a("p",[t._v("é”™è¯¯æ˜¾ç¤ºä¸å…è®¸å‘é€æœ¬åœ°è¯·æ±‚")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Url is blocked: Requests to the local network are not allowed\n")])])]),a("p",[t._v("è§£å†³æ–¹æ³•ï¼Œåœ¨è®¾ç½®ä¸­è®¾ç½®å…è®¸æœ¬åœ°è¿æ¥å³å¯")]),t._v(" "),a("blockquote",[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("admin` => `Settings` => `Outbound requests\n")])])])]),t._v(" "),a("h3",{attrs:{id:"æœåŠ¡æ— æ³•å¯åŠ¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æœåŠ¡æ— æ³•å¯åŠ¨"}},[t._v("#")]),t._v(" æœåŠ¡æ— æ³•å¯åŠ¨")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@localhost gitlab]# gitlab-ctl status\nfail: alertmanager: runsv not running\nfail: gitaly: runsv not running\nfail: gitlab-monitor: runsv not running\nfail: gitlab-workhorse: runsv not running\nfail: logrotate: runsv not running\nfail: nginx: runsv not running\nfail: node-exporter: runsv not running\nfail: postgres-exporter: runsv not running\nfail: postgresql: runsv not running\nfail: prometheus: runsv not running\nfail: redis: runsv not running\nfail: redis-exporter: runsv not running\nfail: sidekiq: runsv not running\nfail: unicorn: runsv not running\n")])])]),a("p",[a("a",{attrs:{href:"https://gitlab.com/gitlab-org/omnibus-gitlab/issues/272",target:"_blank",rel:"noopener noreferrer"}},[t._v("Omnibus gitlab do not restart on CentOS7"),a("OutboundLink")],1),t._v("\nå¼€æœºè‡ªåŠ¨å¯åŠ¨æœåŠ¡")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@localhost ~]# systemctl status gitlab-runsvdir.service -l\nâ— gitlab-runsvdir.service - GitLab Runit supervision process\n   Loaded: loaded (/usr/lib/systemd/system/gitlab-runsvdir.service; enabled; vendor preset: disabled)\n   Active: inactive (dead)\n")])])]),a("p",[t._v("å¦‚æœ "),a("code",[t._v("gitlab-runsvdir.service")]),t._v(" æœåŠ¡æ²¡æœ‰å“åº”ï¼Œä½ å¯èƒ½è¦çœ‹ä¸€ä¸‹å†…å­˜æ˜¯å¦æ»¡äº†ï¼Œéœ€è¦é‡Šæ”¾å†…å­˜ï¼Œè€çš„ç‰ˆæœ¬éœ€è¦ 2G å†…å­˜ï¼Œæ–°ç‰ˆæœ¬éœ€è¦è‡³å°‘ 4G å†…å­˜ã€‚")]),t._v(" "),a("h3",{attrs:{id:"å…¶å®ƒé”™è¯¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å…¶å®ƒé”™è¯¯"}},[t._v("#")]),t._v(" å…¶å®ƒé”™è¯¯")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Error executing action `run` on resource 'bash[migrate gitlab-rails database]'\n")])])]),a("p",[t._v("ä¸Šé¢é”™è¯¯æ˜¯æ•°æ®åº“æ²¡æœ‰å¯åŠ¨ï¼Œæˆ‘ä¸çŸ¥é“å¦‚ä½•å¯åŠ¨ï¼Œæˆ‘é‡å¯äº†æœåŠ¡å™¨ï¼Œç„¶åå¥½çƒäº†ã€‚ğŸ˜†\n"),a("d")],1),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('NameError: uninitialized constant Devise::Async\nProcessing by RootController#index as HTML\nCompleted 401 Unauthorized in 17ms (ActiveRecord: 2.7ms)\n/var/log/gitlab/nginx/gitlab_access.log <==\n114.55.148.71 - - [04/Jan/2017:17:20:24 +0800] "GET /favicon.ico HTTP/1.0" 502 2662 "http://git.xxxxx.cn/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36"\n')])])]),a("h2",{attrs:{id:"å‚è€ƒèµ„æ–™"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒèµ„æ–™"}},[t._v("#")]),t._v(" å‚è€ƒèµ„æ–™")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://packages.gitlab.com/gitlab/gitlab-ce",target:"_blank",rel:"noopener noreferrer"}},[t._v("gitlab/gitlab-ce"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.gitlab.cc/downloads",target:"_blank",rel:"noopener noreferrer"}},[t._v("å®˜ç½‘ä¸‹è½½"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://doc.gitlab.cc/ce/install/requirements.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("å®˜ç½‘å®‰è£…è¯´æ˜"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.gitlab.cc/features/#enterprise",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¼€æºç‰ˆæœ¬å’Œä¼ä¸šç‰ˆæœ¬å¯¹æ¯”"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/update/8.14-to-8.15.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("å®˜æ–¹å‡çº§Gitlabæ•™ç¨‹"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/install/centos",target:"_blank",rel:"noopener noreferrer"}},[t._v("å®˜æ–¹Centoså®‰è£…Gitlabæ•™ç¨‹"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://opjasee.com/2016/01/28/gitlab-upgrade.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitlabå‡çº§è®°å½•"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://www.yuzhewo.com/2015/11/03/%E4%BF%AE%E6%94%B9gitlab%E4%BD%BF%E7%94%A8%E7%8E%B0%E6%9C%89nginx%E6%9C%8D%E5%8A%A1%E5%8F%8A502%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä¿®æ”¹gitlabä½¿ç”¨ç°æœ‰nginxæœåŠ¡åŠ502é—®é¢˜è§£å†³"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://blog.csdn.net/wangxicoding/article/details/43738137",target:"_blank",rel:"noopener noreferrer"}},[t._v("æˆ‘æ‰€é‡åˆ°çš„GitLab 502é—®é¢˜çš„è§£å†³"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);